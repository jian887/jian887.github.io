<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2">



  
  
  <link rel="stylesheet" href="/lib/Han/dist/han.min.css?v=3.3">
















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext">
  






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  



<script data-ad-client="ca-pub-8511538239750965" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta name="description" content="分页实现 前端采用基于bootstrap的轻量级表格插件bootstrap-table(opens new window) 后端采用基于mybatis的轻量级分页插件pageHelper(opens new window)  提示 前后端分页实现流程 #前端调用实现123456789101112var options = &amp;#123;	url: prefix + &quot;/list&quot;,	columns:">
<meta name="keywords" content="ruoyi">
<meta property="og:type" content="article">
<meta property="og:title" content="若衣后端手册">
<meta property="og:url" content="http://jian887.github.io/2023/06/09/若衣后端手册/index.html">
<meta property="og:site_name" content="两角纸博客">
<meta property="og:description" content="分页实现 前端采用基于bootstrap的轻量级表格插件bootstrap-table(opens new window) 后端采用基于mybatis的轻量级分页插件pageHelper(opens new window)  提示 前后端分页实现流程 #前端调用实现123456789101112var options = &amp;#123;	url: prefix + &quot;/list&quot;,	columns:">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-6b1853322c0d5472bee27065023bd06841b.png">
<meta property="og:updated_time" content="2023-06-08T14:52:48.222Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="若衣后端手册">
<meta name="twitter:description" content="分页实现 前端采用基于bootstrap的轻量级表格插件bootstrap-table(opens new window) 后端采用基于mybatis的轻量级分页插件pageHelper(opens new window)  提示 前后端分页实现流程 #前端调用实现123456789101112var options = &amp;#123;	url: prefix + &quot;/list&quot;,	columns:">
<meta name="twitter:image" content="https://oscimg.oschina.net/oscnet/up-6b1853322c0d5472bee27065023bd06841b.png">





  
  
  <link rel="canonical" href="http://jian887.github.io/2023/06/09/若衣后端手册/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>若衣后端手册 | 两角纸博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/jian887" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#FD6C6C; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">两角纸博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">我就是我，不一样的烟火</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">13</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">9</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">24</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://jian887.github.io/2023/06/09/若衣后端手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="两角纸">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="两角纸博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">若衣后端手册

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2023-06-08 22:51:28 / 修改时间：14:52:48" itemprop="dateCreated datePublished" datetime="2023-06-08T22:51:28Z">2023-06-08</time>
            

            
              

              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2023/06/09/若衣后端手册/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2023/06/09/若衣后端手册/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/2023/06/09/若衣后端手册/" class="leancloud_visitors" data-flag-title="若衣后端手册">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h2 id="分页实现"><a href="#分页实现" class="headerlink" title="分页实现"></a>分页实现</h2><ul>
<li>前端采用基于<code>bootstrap</code>的轻量级表格插件<a href="https://github.com/wenzhixin/bootstrap-table" target="_blank" rel="noopener">bootstrap-table(opens new window)</a></li>
<li>后端采用基于<code>mybatis</code>的轻量级分页插件<a href="https://github.com/pagehelper/Mybatis-PageHelper" target="_blank" rel="noopener">pageHelper(opens new window)</a></li>
</ul>
<p>提示</p>
<p>前后端分页实现流程</p>
<h3 id="前端调用实现"><a href="#前端调用实现" class="headerlink" title="#前端调用实现"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#前端调用实现" target="_blank" rel="noopener">#</a>前端调用实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	url: prefix + <span class="string">"/list"</span>,</span><br><span class="line">	columns: [&#123;</span><br><span class="line">		field: <span class="string">'id'</span>,</span><br><span class="line">		title: <span class="string">'主键'</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		field: <span class="string">'name'</span>,</span><br><span class="line">		title: <span class="string">'名称'</span></span><br><span class="line">	&#125;]</span><br><span class="line">&#125;;</span><br><span class="line">$.table.init(options);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义查询条件参数（特殊情况提前设置查询条件下使用）</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	url: prefix + <span class="string">"/list"</span>,</span><br><span class="line">	queryParams: queryParams,</span><br><span class="line">	columns: [&#123;</span><br><span class="line">		field: <span class="string">'id'</span>,</span><br><span class="line">		title: <span class="string">'主键'</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		field: <span class="string">'name'</span>,</span><br><span class="line">		title: <span class="string">'名称'</span></span><br><span class="line">	&#125;]</span><br><span class="line">&#125;;</span><br><span class="line">$.table.init(options);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryParams</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> search = $.table.queryParams(params);</span><br><span class="line">	search.userName = $(<span class="string">"#userName"</span>).val();</span><br><span class="line">	<span class="keyword">return</span> search;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="后台逻辑实现"><a href="#后台逻辑实现" class="headerlink" title="#后台逻辑实现"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#后台逻辑实现" target="_blank" rel="noopener">#</a>后台逻辑实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TableDataInfo <span class="title">list</span><span class="params">(User user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    startPage();  <span class="comment">// 此方法配合前端完成自动分页</span></span><br><span class="line">    List&lt;User&gt; list = userService.selectUserList(user);</span><br><span class="line">    <span class="keyword">return</span> getDataTable(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>常见坑点1：<code>selectPostById</code>莫名其妙的分页。例如下面这段代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">startPage();</span><br><span class="line">List&lt;User&gt; list;</span><br><span class="line"><span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">    list = userService.selectUserList(user);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">&#125;</span><br><span class="line">Post post = postService.selectPostById(<span class="number">1L</span>);</span><br><span class="line"><span class="keyword">return</span> getDataTable(list);</span><br></pre></td></tr></table></figure>
<p>原因分析：这种情况下由于<code>user</code>存在<code>null</code>的情况，就会导致<code>pageHelper</code>生产了一个分页参数，但是没有被消费，这个参数就会一直保留在这个线程上。 当这个线程再次被使用时，就可能导致不该分页的方法去消费这个分页参数，这就产生了莫名其妙的分页。<br>上面这个代码，应该写成下面这个样子才能保证安全。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; list;</span><br><span class="line"><span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">	startPage();</span><br><span class="line">	list = userService.selectUserList(user);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">&#125;</span><br><span class="line">Post post = postService.selectPostById(<span class="number">1L</span>);</span><br><span class="line"><span class="keyword">return</span> getDataTable(list);</span><br></pre></td></tr></table></figure>
<ul>
<li>常见坑点2：添加了<code>startPage</code>方法。也没有正常分页。例如下面这段代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">startPage();</span><br><span class="line">Post post = postService.selectPostById(<span class="number">1L</span>);</span><br><span class="line">List&lt;User&gt; list = userService.selectUserList(user);</span><br><span class="line"><span class="keyword">return</span> getDataTable(list);</span><br></pre></td></tr></table></figure>
<p>原因分析：只对该语句以后的第一个查询<code>（Select）</code>语句得到的数据进行分页。<br>上面这个代码，应该写成下面这个样子才能正常分页。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Post post = postService.selectPostById(<span class="number">1L</span>);</span><br><span class="line">startPage();</span><br><span class="line">List&lt;User&gt; list = userService.selectUserList(user);</span><br><span class="line"><span class="keyword">return</span> getDataTable(list);</span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>如果改为其他数据库需修改配置<code>application.yml</code>文件中的属性<code>helperDialect=你的数据库</code></p>
<h2 id="导入导出"><a href="#导入导出" class="headerlink" title="#导入导出"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#导入导出" target="_blank" rel="noopener">#</a>导入导出</h2><p>在实际开发中经常需要使用导入导出功能来加快数据的操作。在项目中可以使用注解来完成此项功能。 在需要被导入导出的实体类属性添加<code>@Excel</code>注解，目前支持参数如下：</p>
<h3 id="注解参数说明"><a href="#注解参数说明" class="headerlink" title="#注解参数说明"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#注解参数说明" target="_blank" rel="noopener">#</a>注解参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>sort</td>
<td>int</td>
<td>Integer.MAX_VALUE</td>
<td>导出时在excel中排序，值越小越靠前</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>空</td>
<td>导出到Excel中的名字</td>
</tr>
<tr>
<td>dateFormat</td>
<td>String</td>
<td>空</td>
<td>日期格式, 如: yyyy-MM-dd</td>
</tr>
<tr>
<td>dictType</td>
<td>String</td>
<td>空</td>
<td>如果是字典类型，请设置字典的type值 (如: sys_user_sex)</td>
</tr>
<tr>
<td>readConverterExp</td>
<td>String</td>
<td>空</td>
<td>读取内容转表达式 (如: 0=男,1=女,2=未知)</td>
</tr>
<tr>
<td>separator</td>
<td>String</td>
<td>,</td>
<td>分隔符，读取字符串组内容</td>
</tr>
<tr>
<td>scale</td>
<td>int</td>
<td>-1</td>
<td>BigDecimal 精度 默认:-1(默认不开启BigDecimal格式化)</td>
</tr>
<tr>
<td>roundingMode</td>
<td>int</td>
<td>BigDecimal.ROUND_HALF_EVEN</td>
<td>BigDecimal 舍入规则 默认:BigDecimal.ROUND_HALF_EVEN</td>
</tr>
<tr>
<td>celltype</td>
<td>Enum</td>
<td>Type.STRING</td>
<td>导出类型（0数字 1字符串 2图片）</td>
</tr>
<tr>
<td>height</td>
<td>String</td>
<td>14</td>
<td>导出时在excel中每个列的高度 单位为字符</td>
</tr>
<tr>
<td>width</td>
<td>String</td>
<td>16</td>
<td>导出时在excel中每个列的宽 单位为字符</td>
</tr>
<tr>
<td>suffix</td>
<td>String</td>
<td>空</td>
<td>文字后缀,如% 90 变成90%</td>
</tr>
<tr>
<td>defaultValue</td>
<td>String</td>
<td>空</td>
<td>当值为空时,字段的默认值</td>
</tr>
<tr>
<td>prompt</td>
<td>String</td>
<td>空</td>
<td>提示信息</td>
</tr>
<tr>
<td>combo</td>
<td>String</td>
<td>Null</td>
<td>设置只能选择不能输入的列内容</td>
</tr>
<tr>
<td>headerBackgroundColor</td>
<td>Enum</td>
<td>IndexedColors.GREY_50_PERCENT</td>
<td>导出列头背景色IndexedColors.XXXX</td>
</tr>
<tr>
<td>headerColor</td>
<td>Enum</td>
<td>IndexedColors.WHITE</td>
<td>导出列头字体颜色IndexedColors.XXXX</td>
</tr>
<tr>
<td>backgroundColor</td>
<td>Enum</td>
<td>IndexedColors.WHITE</td>
<td>导出单元格背景色IndexedColors.XXXX</td>
</tr>
<tr>
<td>color</td>
<td>Enum</td>
<td>IndexedColors.BLACK</td>
<td>导出单元格字体颜色IndexedColors.XXXX</td>
</tr>
<tr>
<td>targetAttr</td>
<td>String</td>
<td>空</td>
<td>另一个类中的属性名称,支持多级获取,以小数点隔开</td>
</tr>
<tr>
<td>isStatistics</td>
<td>boolean</td>
<td>false</td>
<td>是否自动统计数据,在最后追加一行统计数据总和</td>
</tr>
<tr>
<td>type</td>
<td>Enum</td>
<td>Type.ALL</td>
<td>字段类型（0：导出导入；1：仅导出；2：仅导入）</td>
</tr>
<tr>
<td>align</td>
<td>Enum</td>
<td>HorizontalAlignment.CENTER</td>
<td>导出对齐方式HorizontalAlignment.XXXX</td>
</tr>
<tr>
<td>handler</td>
<td>Class</td>
<td>ExcelHandlerAdapter.class</td>
<td>自定义数据处理器</td>
</tr>
<tr>
<td>args</td>
<td>String[]</td>
<td>{}</td>
<td>自定义数据处理器参数</td>
</tr>
</tbody>
</table>
<h3 id="导出实现流程"><a href="#导出实现流程" class="headerlink" title="#导出实现流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#导出实现流程" target="_blank" rel="noopener">#</a>导出实现流程</h3><p>1、前端调用封装好的方法<code>$.table.init</code>，传入后台<code>exportUrl</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	exportUrl: prefix + <span class="string">"/export"</span>,</span><br><span class="line">	columns: [&#123;</span><br><span class="line">		field: <span class="string">'id'</span>,</span><br><span class="line">		title: <span class="string">'主键'</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		field: <span class="string">'name'</span>,</span><br><span class="line">		title: <span class="string">'名称'</span></span><br><span class="line">	&#125;]</span><br><span class="line">&#125;;</span><br><span class="line">$.table.init(options);</span><br></pre></td></tr></table></figure>
<p>2、添加导出按钮事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span> <span class="attr">onclick</span>=<span class="string">"$.table.exportExcel()"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-download"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 导出</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、在实体变量上添加<code>@Excel</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户序号"</span>, prompt = <span class="string">"用户编号"</span>)</span><br><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户名称"</span>)</span><br><span class="line"><span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户性别"</span>, readConverterExp = <span class="string">"0=男,1=女,2=未知"</span>)</span><br><span class="line"><span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户头像"</span>, cellType = ColumnType.IMAGE)</span><br><span class="line"><span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"帐号状态"</span>, dictType = <span class="string">"sys_normal_disable"</span>)</span><br><span class="line"><span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"最后登陆时间"</span>, width = <span class="number">30</span>, dateFormat = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span><br><span class="line"><span class="keyword">private</span> Date loginDate;</span><br></pre></td></tr></table></figure>
<p>4、在<code>Controller</code>添加导出方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/export"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">export</span><span class="params">(User user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	List&lt;User&gt; list = userService.selectUserList(user);</span><br><span class="line">	ExcelUtil&lt;User&gt; util = <span class="keyword">new</span> ExcelUtil&lt;User&gt;(User.class);</span><br><span class="line">	<span class="keyword">return</span> util.exportExcel(list, <span class="string">"用户数据"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<p>导出默认流程是先创建一个临时文件，等待前端请求下载结束后马上删除这个临时文件。如遇到迅雷这种二次请求下载应用可能会导致文件已经被删除，我们也可以改成流的形式返回给前端。 参考实现 - <a href="http://doc.ruoyi.vip/ruoyi/other/faq.html#如何解决导出使用下载插件出现异常" target="_blank" rel="noopener">如何解决导出使用下载插件出现异常</a></p>
<h3 id="导入实现流程"><a href="#导入实现流程" class="headerlink" title="#导入实现流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#导入实现流程" target="_blank" rel="noopener">#</a>导入实现流程</h3><p>1、前端调用封装好的方法<code>$.table.init</code>，传入后台<code>importUrl</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">	importUrl: prefix + <span class="string">"/importData"</span>,</span><br><span class="line">	columns: [&#123;</span><br><span class="line">		field: <span class="string">'id'</span>,</span><br><span class="line">		title: <span class="string">'主键'</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		field: <span class="string">'name'</span>,</span><br><span class="line">		title: <span class="string">'名称'</span></span><br><span class="line">	&#125;]</span><br><span class="line">&#125;;</span><br><span class="line">$.table.init(options);</span><br></pre></td></tr></table></figure>
<p>2、添加导入按钮事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-info"</span> <span class="attr">onclick</span>=<span class="string">"$.table.importExcel()"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-upload"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 导入</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、添加导入前端代码，<code>form</code>默认<code>id</code>为<code>importForm</code>，也可指定<code>importExcel(id)</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入区域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"importTpl"</span> <span class="attr">type</span>=<span class="string">"text/template"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">&lt;form enctype=<span class="string">"multipart/form-data"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"mt20 mb10"</span>&gt;</span></span><br><span class="line"><span class="javascript">	&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"col-xs-offset-1"</span>&gt;</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>/&gt;</span></span></span><br><span class="line"><span class="javascript">		&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"mt10 pt5"</span>&gt;</span></span><br><span class="line"><span class="xml">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"updateSupport"</span> <span class="attr">name</span>=<span class="string">"updateSupport"</span> <span class="attr">title</span>=<span class="string">"如果登录账户已经存在，更新这条数据。"</span>&gt;</span> 是否更新已经存在的用户数据</span></span><br><span class="line"><span class="javascript">			 &amp;nbsp;	<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"$.table.importTemplate()"</span> <span class="attr">class</span>=<span class="string">"btn btn-default btn-xs"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-file-excel-o"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 下载模板<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="javascript">		&lt;font color=<span class="string">"red"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"pull-left mt10"</span>&gt;</span></span><br><span class="line"><span class="undefined">			提示：仅允许导入“xls”或“xlsx”格式文件！</span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、在实体变量上添加<code>@Excel</code>注解，默认为导出导入，也可以单独设置仅导入<code>Type.IMPORT</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户序号"</span>)</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"部门编号"</span>, type = Type.IMPORT)</span><br><span class="line"><span class="keyword">private</span> Long deptId;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"用户名称"</span>)</span><br><span class="line"><span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 导出部门多个对象 */</span></span><br><span class="line"><span class="meta">@Excels</span>(&#123;</span><br><span class="line">	<span class="meta">@Excel</span>(name = <span class="string">"部门名称"</span>, targetAttr = <span class="string">"deptName"</span>, type = Type.EXPORT),</span><br><span class="line">	<span class="meta">@Excel</span>(name = <span class="string">"部门负责人"</span>, targetAttr = <span class="string">"leader"</span>, type = Type.EXPORT)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">private</span> SysDept dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 导出部门单个对象 */</span></span><br><span class="line"><span class="meta">@Excel</span>(name = <span class="string">"部门名称"</span>, targetAttr = <span class="string">"deptName"</span>, type = Type.EXPORT)</span><br><span class="line"><span class="keyword">private</span> SysDept dept;</span><br></pre></td></tr></table></figure>
<p>5、在<code>Controller</code>添加导入方法，<code>updateSupport</code>属性为是否存在则覆盖（可选）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/importData"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">importData</span><span class="params">(MultipartFile file, <span class="keyword">boolean</span> updateSupport)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ExcelUtil&lt;SysUser&gt; util = <span class="keyword">new</span> ExcelUtil&lt;SysUser&gt;(SysUser.class);</span><br><span class="line">	List&lt;SysUser&gt; userList = util.importExcel(file.getInputStream());</span><br><span class="line">	String operName = ShiroUtils.getSysUser().getLoginName();</span><br><span class="line">	String message = userService.importUser(userList, updateSupport, operName);</span><br><span class="line">	<span class="keyword">return</span> AjaxResult.success(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<p>也可以直接到main运行此方法测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InputStream is = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"D:\\test.xlsx"</span>));</span><br><span class="line">ExcelUtil&lt;Entity&gt; util = <span class="keyword">new</span> ExcelUtil&lt;Entity&gt;(Entity.class);</span><br><span class="line">List&lt;Entity&gt; userList = util.importExcel(is);</span><br></pre></td></tr></table></figure>
<h3 id="自定义标题信息"><a href="#自定义标题信息" class="headerlink" title="#自定义标题信息"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#自定义标题信息" target="_blank" rel="noopener">#</a>自定义标题信息</h3><p>有时候我们希望导出表格包含标题信息，我们可以这样做。</p>
<p><strong>导出用户管理表格新增标题（用户列表）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">export</span><span class="params">(SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	List&lt;SysUser&gt; list = userService.selectUserList(user);</span><br><span class="line">	ExcelUtil&lt;SysUser&gt; util = <span class="keyword">new</span> ExcelUtil&lt;SysUser&gt;(SysUser.class);</span><br><span class="line">	<span class="keyword">return</span> util.exportExcel(list, <span class="string">"用户数据"</span>, <span class="string">"用户列表"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>导入表格包含标题处理方式，其中<code>1</code>表示标题占用行数，根据实际情况填写。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">importData</span><span class="params">(MultipartFile file, <span class="keyword">boolean</span> updateSupport)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ExcelUtil&lt;SysUser&gt; util = <span class="keyword">new</span> ExcelUtil&lt;SysUser&gt;(SysUser.class);</span><br><span class="line">	List&lt;SysUser&gt; userList = util.importExcel(file.getInputStream(), <span class="number">1</span>);</span><br><span class="line">	String operName = SecurityUtils.getUsername();</span><br><span class="line">	String message = userService.importUser(userList, updateSupport, operName);</span><br><span class="line">	<span class="keyword">return</span> AjaxResult.success(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义数据处理器"><a href="#自定义数据处理器" class="headerlink" title="#自定义数据处理器"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#自定义数据处理器" target="_blank" rel="noopener">#</a>自定义数据处理器</h3><p>有时候我们希望数据展现为一个特殊的格式，或者需要对数据进行其它处理。<code>Excel</code>注解提供了自定义数据处理器以满足各种业务场景。而实现一个数据处理器也是非常简单的。如下：</p>
<p>1、在实体类用<code>Excel</code>注解<code>handler</code>属性指定自定义的数据处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"用户名称"</span>, handler = MyDataHandler.class, args = &#123; <span class="string">"aaa"</span>, <span class="string">"bbb"</span> &#125;)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、编写数据处理器<code>MyDataHandler</code>继承<code>ExcelHandlerAdapter</code>，返回值为处理后的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataHandler</span> <span class="keyword">implements</span> <span class="title">ExcelHandlerAdapter</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">format</span><span class="params">(Object value, String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// value 为单元格数据值</span></span><br><span class="line">		<span class="comment">// args 为excel注解args参数组</span></span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义隐藏属性列"><a href="#自定义隐藏属性列" class="headerlink" title="#自定义隐藏属性列"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#自定义隐藏属性列" target="_blank" rel="noopener">#</a>自定义隐藏属性列</h3><p>有时候我们希望对列信息根据业务去动态显示，那么我们可以进行如下处理。</p>
<p>示例：对用户进行条件判断，符合条件则隐藏属性。导出的文件则不会显示此列信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/export"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">export</span><span class="params">(HttpServletResponse response, SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	List&lt;SysUser&gt; list = userService.selectUserList(user);</span><br><span class="line">	ExcelUtil&lt;SysUser&gt; util = <span class="keyword">new</span> ExcelUtil&lt;SysUser&gt;(SysUser.class);</span><br><span class="line">	<span class="keyword">if</span> (条件A) &#123;</span><br><span class="line">	  <span class="comment">// 不显示用户ID（单个）</span></span><br><span class="line">	  util.hideColumn(<span class="string">"userId"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (条件B) &#123;</span><br><span class="line">	  <span class="comment">// 不显示用户名称、用户手机（多个）</span></span><br><span class="line">	  util.hideColumn(<span class="string">"userId"</span>, <span class="string">"phonenumber"</span>);</span><br><span class="line">	&#125; &#125; <span class="keyword">else</span> <span class="keyword">if</span> (条件C) &#123;</span><br><span class="line">	  <span class="comment">// 不显示用户邮箱、部门名称（子对象）</span></span><br><span class="line">	  util.hideColumn(<span class="string">"email"</span>, <span class="string">"dept.deptName"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	util.exportExcel(response, list, <span class="string">"用户数据"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="导出对象的子列表"><a href="#导出对象的子列表" class="headerlink" title="#导出对象的子列表"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#导出对象的子列表" target="_blank" rel="noopener">#</a>导出对象的子列表</h3><p>有时候对象里面还包含集合列表，例如用户管理包含多个角色需要导出，那么我们可以进行如下处理。</p>
<p><strong>SysUser.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUser</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"用户编号"</span>, cellType = ColumnType.NUMERIC, width = <span class="number">20</span>, needMerge = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"用户名称"</span>, width = <span class="number">20</span>, needMerge = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"邮箱"</span>, width = <span class="number">20</span>, needMerge = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"角色"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SysRole&gt; <span class="title">getRoles</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(List&lt;SysRole&gt; roles)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>SysRole.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysRole</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"角色编号"</span>, cellType = ColumnType.NUMERIC)</span><br><span class="line">    <span class="keyword">private</span> String roleId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"角色名称"</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Excel</span>(name = <span class="string">"角色字符"</span>)</span><br><span class="line">    <span class="keyword">private</span> String roleKey;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleId</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleId</span><span class="params">(String roleId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleId = roleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleName</span><span class="params">(String roleName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleName = roleName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoleKey</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleKey</span><span class="params">(String roleKey)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleKey = roleKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试验证</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        List&lt;SysUser&gt; userList = <span class="keyword">new</span> ArrayList&lt;SysUser&gt;();</span><br><span class="line"></span><br><span class="line">        SysUser user1 = <span class="keyword">new</span> SysUser();</span><br><span class="line">        List&lt;SysRole&gt; roles1 = <span class="keyword">new</span> ArrayList&lt;SysRole&gt;();</span><br><span class="line"></span><br><span class="line">        SysRole role1 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role1.setRoleId(<span class="string">"1"</span>);</span><br><span class="line">        role1.setRoleName(<span class="string">"超级管理员"</span>);</span><br><span class="line">        role1.setRoleKey(<span class="string">"admin_key"</span>);</span><br><span class="line"></span><br><span class="line">        SysRole role2 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role2.setRoleId(<span class="string">"2"</span>);</span><br><span class="line">        role2.setRoleName(<span class="string">"普通角色"</span>);</span><br><span class="line">        role2.setRoleKey(<span class="string">"common_key"</span>);</span><br><span class="line">        </span><br><span class="line">        SysRole role3 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role3.setRoleId(<span class="string">"3"</span>);</span><br><span class="line">        role3.setRoleName(<span class="string">"测试角色"</span>);</span><br><span class="line">        role3.setRoleKey(<span class="string">"test_key"</span>);</span><br><span class="line">        </span><br><span class="line">        SysRole role4 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role4.setRoleId(<span class="string">"4"</span>);</span><br><span class="line">        role4.setRoleName(<span class="string">"查询角色"</span>);</span><br><span class="line">        role4.setRoleKey(<span class="string">"query_key"</span>);</span><br><span class="line"></span><br><span class="line">        roles1.add(role1);</span><br><span class="line">        roles1.add(role2);</span><br><span class="line">        roles1.add(role3);</span><br><span class="line">        roles1.add(role4);</span><br><span class="line"></span><br><span class="line">        user1.setUserId(<span class="string">"1"</span>);</span><br><span class="line">        user1.setUserName(<span class="string">"admin"</span>);</span><br><span class="line">        user1.setEmail(<span class="string">"ry@qq.com"</span>);</span><br><span class="line">        user1.setRoles(roles1);</span><br><span class="line"></span><br><span class="line">        userList.add(user1);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        SysUser user2 = <span class="keyword">new</span> SysUser();</span><br><span class="line">        List&lt;SysRole&gt; roles2 = <span class="keyword">new</span> ArrayList&lt;SysRole&gt;();</span><br><span class="line"></span><br><span class="line">        SysRole role21 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role21.setRoleId(<span class="string">"4"</span>);</span><br><span class="line">        role21.setRoleName(<span class="string">"研发角色"</span>);</span><br><span class="line">        role21.setRoleKey(<span class="string">"yanfa_key"</span>);</span><br><span class="line"></span><br><span class="line">        SysRole role22 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role22.setRoleId(<span class="string">"5"</span>);</span><br><span class="line">        role22.setRoleName(<span class="string">"销售角色"</span>);</span><br><span class="line">        role22.setRoleKey(<span class="string">"xiaoshou_key"</span>);</span><br><span class="line"></span><br><span class="line">        roles2.add(role21);</span><br><span class="line">        roles2.add(role22);</span><br><span class="line"></span><br><span class="line">        user2.setUserId(<span class="string">"2"</span>);</span><br><span class="line">        user2.setUserName(<span class="string">"ry"</span>);</span><br><span class="line">        user2.setEmail(<span class="string">"admin@qq.com"</span>);</span><br><span class="line">        user2.setRoles(roles2);</span><br><span class="line">        </span><br><span class="line">        userList.add(user2);</span><br><span class="line">        </span><br><span class="line">        SysUser user3 = <span class="keyword">new</span> SysUser();</span><br><span class="line">        List&lt;SysRole&gt; roles3 = <span class="keyword">new</span> ArrayList&lt;SysRole&gt;();</span><br><span class="line"></span><br><span class="line">        SysRole role31 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role31.setRoleId(<span class="string">"4"</span>);</span><br><span class="line">        role31.setRoleName(<span class="string">"张三角色"</span>);</span><br><span class="line">        role31.setRoleKey(<span class="string">"zs_key"</span>);</span><br><span class="line"></span><br><span class="line">        SysRole role32 = <span class="keyword">new</span> SysRole();</span><br><span class="line">        role32.setRoleId(<span class="string">"5"</span>);</span><br><span class="line">        role32.setRoleName(<span class="string">"李四角色"</span>);</span><br><span class="line">        role32.setRoleKey(<span class="string">"ls_key"</span>);</span><br><span class="line"></span><br><span class="line">        roles3.add(role31);</span><br><span class="line">        roles3.add(role32);</span><br><span class="line"></span><br><span class="line">        user3.setUserId(<span class="string">"3"</span>);</span><br><span class="line">        user3.setUserName(<span class="string">"test"</span>);</span><br><span class="line">        user3.setEmail(<span class="string">"test@qq.com"</span>);</span><br><span class="line">        user3.setRoles(roles3);</span><br><span class="line">        </span><br><span class="line">        userList.add(user3);</span><br><span class="line"></span><br><span class="line">        ExcelUtil&lt;SysUser&gt; util = <span class="keyword">new</span> ExcelUtil&lt;SysUser&gt;(SysUser.class);</span><br><span class="line">        AjaxResult ajax = util.exportExcel(userList, <span class="string">"用户数据"</span>, <span class="string">"用户数据"</span>);</span><br><span class="line">        System.out.println(ajax.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>导出文件结果</strong> <img src="https://oscimg.oschina.net/oscnet/up-6b1853322c0d5472bee27065023bd06841b.png" alt="ruoyi-sub-execl"></p>
<h2 id="上传下载"><a href="#上传下载" class="headerlink" title="#上传下载"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#上传下载" target="_blank" rel="noopener">#</a>上传下载</h2><p>首先创建一张上传文件的表，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> sys_file_info;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_file_info (</span><br><span class="line">  file_id           <span class="built_in">int</span>(<span class="number">11</span>)          <span class="keyword">not</span> <span class="literal">null</span> auto_increment       <span class="keyword">comment</span> <span class="string">'文件id'</span>,</span><br><span class="line">  file_name         <span class="built_in">varchar</span>(<span class="number">50</span>)      <span class="keyword">default</span> <span class="string">''</span>                    <span class="keyword">comment</span> <span class="string">'文件名称'</span>,</span><br><span class="line">  file_path         <span class="built_in">varchar</span>(<span class="number">255</span>)     <span class="keyword">default</span> <span class="string">''</span>                    <span class="keyword">comment</span> <span class="string">'文件路径'</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (file_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8 <span class="keyword">comment</span> = <span class="string">'文件信息表'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="上传实现流程"><a href="#上传实现流程" class="headerlink" title="#上传实现流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#上传实现流程" target="_blank" rel="noopener">#</a>上传实现流程</h3><p>1、代码生成<code>sys_file_info</code>表相关代码并复制到对应目录。</p>
<p>2、参考示例修改代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"filePath"</span> <span class="attr">name</span>=<span class="string">"filePath"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">type</span>=<span class="string">"file"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">submitHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ($.validate.form()) &#123;</span><br><span class="line">		uploadFile();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">	<span class="keyword">if</span> ($(<span class="string">'#filePath'</span>)[<span class="number">0</span>].files[<span class="number">0</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">		$.modal.alertWarning(<span class="string">"请先选择文件路径"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	formData.append(<span class="string">'fileName'</span>, $(<span class="string">"input[name='fileName']"</span>).val());</span><br><span class="line">	formData.append(<span class="string">'file'</span>, $(<span class="string">'#filePath'</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">	$.ajax(&#123;</span><br><span class="line">		url: prefix + <span class="string">"/add"</span>,</span><br><span class="line">		type: <span class="string">'post'</span>,</span><br><span class="line">		cache: <span class="literal">false</span>,</span><br><span class="line">		data: formData,</span><br><span class="line">		processData: <span class="literal">false</span>,</span><br><span class="line">		contentType: <span class="literal">false</span>,</span><br><span class="line">		dataType: <span class="string">"json"</span>,</span><br><span class="line">		success: <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">			$.operate.successCallback(result);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、在<code>SysFileInfoController</code>添加对应上传方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">addSave</span><span class="params">(@RequestParam(<span class="string">"file"</span>)</span> MultipartFile file, SysFileInfo fileInfo) <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 上传文件路径</span></span><br><span class="line">	String filePath = RuoYiConfig.getUploadPath();</span><br><span class="line">	<span class="comment">// 上传并返回新文件名称</span></span><br><span class="line">	String fileName = FileUploadUtils.upload(filePath, file);</span><br><span class="line">	fileInfo.setFilePath(fileName);</span><br><span class="line">	<span class="keyword">return</span> toAjax(sysFileInfoService.insertSysFileInfo(fileInfo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、上传成功后需要预览可以对该属性格式化处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	field : <span class="string">'filePath'</span>, </span><br><span class="line">	title: <span class="string">'文件预览'</span>,</span><br><span class="line">	formatter: <span class="function"><span class="keyword">function</span>(<span class="params">value, row, index</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> $.table.imageView(value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>如需对文件格式控制，设置<code>application.yml</code>中的<code>multipart</code>属性</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件上传</span></span><br><span class="line"><span class="attr">servlet:</span></span><br><span class="line"><span class="attr">   multipart:</span></span><br><span class="line">     <span class="comment"># 单个文件大小</span></span><br><span class="line"><span class="attr">     max-file-size:</span>  <span class="number">10</span><span class="string">MB</span></span><br><span class="line">     <span class="comment"># 设置总上传的文件大小</span></span><br><span class="line"><span class="attr">     max-request-size:</span>  <span class="number">20</span><span class="string">MB</span></span><br></pre></td></tr></table></figure>
<p>注意：如果只是单纯的上传一张图片没有其他参数可以使用通用方法 <code>/common/upload</code><br>请求处理方法 <code>com.ruoyi.web.controller.common.CommonController</code></p>
<h3 id="下载实现流程"><a href="#下载实现流程" class="headerlink" title="#下载实现流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#下载实现流程" target="_blank" rel="noopener">#</a>下载实现流程</h3><p>1、参考示例代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">window</span>.location.href = ctx + <span class="string">"common/download/resource?resource="</span> + value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、参考<code>Controller</code>下载方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本地资源通用下载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/common/download/resource"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resourceDownload</span><span class="params">(String resource, HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 本地资源路径</span></span><br><span class="line">	String localPath = Global.getProfile();</span><br><span class="line">	<span class="comment">// 数据库资源地址</span></span><br><span class="line">	String downloadPath = localPath + StringUtils.substringAfter(resource, Constants.RESOURCE_PREFIX);</span><br><span class="line">	<span class="comment">// 下载名称</span></span><br><span class="line">	String downloadName = StringUtils.substringAfterLast(downloadPath, <span class="string">"/"</span>);</span><br><span class="line">	response.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">	response.setContentType(<span class="string">"multipart/form-data"</span>);</span><br><span class="line">	response.setHeader(<span class="string">"Content-Disposition"</span>,</span><br><span class="line">			<span class="string">"attachment;fileName="</span> + FileUtils.setFileDownloadHeader(request, downloadName));</span><br><span class="line">	FileUtils.writeBytes(downloadPath, response.getOutputStream());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="权限注解"><a href="#权限注解" class="headerlink" title="权限注解"></a>权限注解</h2><p><code>Shiro</code>注解权限控制</p>
<ul>
<li><code>@RequiresAuthentication</code>使用该注解标注的类，实例，方法在访问或调用时，当前Subject必须在当前session中已经过认证。</li>
<li><code>@RequiresGuest</code>使用该注解标注的类，实例，方法在访问或调用时，当前Subject可以是gust身份，不需要经过认证或者在原先的session中存在记录。</li>
<li><code>@RequiresPermissions</code>当前Subject需要拥有某些特定的权限时，才能执行被该注解标注的方法。如果当前Subject不具有这样的权限，则方法不会被执行。</li>
<li><code>@RequiresRoles</code>当前Subject必须拥有所有指定的角色时，才能访问被该注解标注的方法。如果当天Subject不同时拥有所有指定角色，则方法不会执行还会抛出AuthorizationException异常。</li>
<li><code>@RequiresUser</code>当前Subject必须是应用的用户，才能访问或调用被该注解标注的类，实例，方法。</li>
</ul>
<h3 id="RequiresRoles"><a href="#RequiresRoles" class="headerlink" title="@RequiresRoles"></a>@RequiresRoles</h3><p><code>@RequiresRoles</code>注解用于配置接口要求用户拥有某（些）角色才可访问，它拥有两个参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:left">类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td style="text-align:left">String[]</td>
<td>角色列表</td>
</tr>
<tr>
<td>logical</td>
<td style="text-align:left">Logical</td>
<td>角色之间的判断关系，默认为Logical.AND</td>
</tr>
</tbody>
</table>
<p>示例1: 以下代码表示必须拥有<code>admin</code>角色才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresRoles</span>(<span class="string">"admin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例2: 以下代码表示必须拥有<code>admin</code>和<code>common</code>角色才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresRoles</span>(&#123;<span class="string">"admin"</span>, <span class="string">"common"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例3: 以下代码表示需要拥有<code>admin</code>或<code>common</code>角色才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresRoles</span>(value = &#123;<span class="string">"admin"</span>, <span class="string">"common"</span>&#125;, logical = Logical.OR)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="RequiresPermissions"><a href="#RequiresPermissions" class="headerlink" title="#@RequiresPermissions"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#requirespermissions" target="_blank" rel="noopener">#</a>@RequiresPermissions</h3><p><code>@RequiresPermissions</code>注解用于配置接口要求用户拥有某（些）权限才可访问，它拥有两个参数</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>String[]</td>
<td>权限列表</td>
</tr>
<tr>
<td>logical</td>
<td>Logical</td>
<td>权限之间的判断关系，默认为Logical.AND</td>
</tr>
</tbody>
</table>
<p>示例1: 以下代码表示必须拥有<code>system:user:add</code>权限才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions</span>(<span class="string">"system:user:add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例2: 以下代码表示必须拥有<code>system:user:add</code>和<code>system:user:edit</code>权限才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions</span>(&#123;<span class="string">"system:user:add"</span>, <span class="string">"system:user:edit"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例3: 以下代码表示需要拥有<code>system:user:add</code>或<code>system:user:edit</code>权限才可访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermissions</span>(value = &#123;<span class="string">"system:user:add"</span>, <span class="string">"system:user:edit"</span>&#125;, logical = Logical.OR)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">save</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<p>Shiro的认证注解处理是有内定的处理顺序的，如果有个多个注解的话，前面的通过了会继续检查后面的，若不通过则直接返回，处理顺序依次为（与实际声明顺序无关） RequiresRoles、RequiresPermissions、RequiresAuthentication、RequiresUser、RequiresGuest。<br>例如：你同时声明了<code>RequiresRoles</code>和<code>RequiresPermissions</code>，那就要求拥有此角色的同时还得拥有相应的权限。</p>
<h3 id="编程式判断资源访问权限"><a href="#编程式判断资源访问权限" class="headerlink" title="#编程式判断资源访问权限"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#编程式判断资源访问权限" target="_blank" rel="noopener">#</a>编程式判断资源访问权限</h3><p>示例: 编程式判断资源访问权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = ShiroUtils.getSubject();</span><br><span class="line">subject.isPermitted(permission)        <span class="comment">// 验证是否有资源权限</span></span><br><span class="line">subject.isPermittedAll(permissions)    <span class="comment">// 验证是否有资源权限（列表）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如：</span></span><br><span class="line"><span class="keyword">if</span> (subject.isPermitted(<span class="string">"sys:user:edit"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    System.out.pirntln(<span class="string">"当前用户有编辑用户权限"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例: 编程式判断角色访问权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = ShiroUtils.getSubject();</span><br><span class="line">subject.hasRole(role)        <span class="comment">// 验证是否有角色权限</span></span><br><span class="line">subject.hasRoles(roles)      <span class="comment">// 验证是否有角色权限（列表）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如：</span></span><br><span class="line"><span class="keyword">if</span> (subject.hasRole(<span class="string">"admin"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    System.out.pirntln(<span class="string">"当前用户有admin角色权限"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="基于URI判断用户访问权限"><a href="#基于URI判断用户访问权限" class="headerlink" title="#基于URI判断用户访问权限"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#基于uri判断用户访问权限" target="_blank" rel="noopener">#</a>基于URI判断用户访问权限</h3><p>示例: 基于URI判断用户访问权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证是否有资源权限</span></span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/system/user/add"</span>, <span class="string">"perms[system:user:add]"</span>);</span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/system/user/**"</span>, <span class="string">"perms[system:user:*]"</span>);</span><br><span class="line"><span class="comment">// 验证是否有资源权限（列表），相当于isPermitedAll()方法。</span></span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/system/user/**"</span>, <span class="string">"perms[system:user:add,system:user:edit]"</span>);</span><br></pre></td></tr></table></figure>
<p>示例: 基于URI判断角色访问权限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证是否有角色权限</span></span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/system/user/**"</span>, <span class="string">"roles[admin]"</span>);</span><br><span class="line"><span class="comment">// 验证是否有角色权限（列表），相当于hasAllRoles()方法。</span></span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/system/user/**"</span>, <span class="string">"roles[admin,common]"</span>);</span><br></pre></td></tr></table></figure>
<p>URI通配符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?  ：匹配一个字符。</span><br><span class="line">*  ：匹配零个或多个字符串。</span><br><span class="line">** ：匹配路径中的零个或多个路径。</span><br></pre></td></tr></table></figure>
<h2 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h2><p>新建的<code>Spring Boot</code>项目中，一般都会引用<code>spring-boot-starter</code>或者<code>spring-boot-starter-web</code>，而这两个起步依赖中都已经包含了对于<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-data-jpa</code>的依赖。 当我们使用了这两个依赖的时候，框架会自动默认分别注入<code>DataSourceTransactionManager</code>或<code>JpaTransactionManager</code>。 所以我们不需要任何额外配置就可以用<code>@Transactional</code>注解进行事务的使用。</p>
<p>提示</p>
<p>@Transactional注解只能应用到public可见度的方法上，可以被应用于接口定义和接口方法，方法会覆盖类上面声明的事务。</p>
<p>例如用户新增需要插入用户表、用户与岗位关联表、用户与角色关联表，如果插入成功，那么一起成功，如果中间有一条出现异常，那么回滚之前的所有操作， 这样可以防止出现脏数据，就可以使用事务让它实现回退。<br>做法非常简单，我们只需要在方法或类添加<code>@Transactional</code>注解即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 新增用户信息</span></span><br><span class="line">	<span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">	<span class="comment">// 新增用户岗位关联</span></span><br><span class="line">	insertUserPost(user);</span><br><span class="line">	<span class="comment">// 新增用户与角色管理</span></span><br><span class="line">	insertUserRole(user);</span><br><span class="line">	<span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>常见坑点1：遇到检查异常时，事务开启，也无法回滚。 例如下面这段代码，用户依旧增加成功，并没有因为后面遇到检查异常而回滚！！</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 新增用户信息</span></span><br><span class="line">	<span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">	<span class="comment">// 新增用户岗位关联</span></span><br><span class="line">	insertUserPost(user);</span><br><span class="line">	<span class="comment">// 新增用户与角色管理</span></span><br><span class="line">	insertUserRole(user);</span><br><span class="line">	<span class="comment">// 模拟抛出SQLException异常</span></span><br><span class="line">	<span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"发生异常了.."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因分析：因为<code>Spring</code>的默认的事务规则是遇到运行异常<code>（RuntimeException）</code>和程序错误<code>（Error）</code>才会回滚。如果想针对检查异常进行事务回滚，可以在<code>@Transactional</code>注解里使用 <code>rollbackFor</code>属性明确指定异常。<br>例如下面这样，就可以正常回滚：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(rollbackFor = Exception.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 新增用户信息</span></span><br><span class="line">	<span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">	<span class="comment">// 新增用户岗位关联</span></span><br><span class="line">	insertUserPost(user);</span><br><span class="line">	<span class="comment">// 新增用户与角色管理</span></span><br><span class="line">	insertUserRole(user);</span><br><span class="line">	<span class="comment">// 模拟抛出SQLException异常</span></span><br><span class="line">	<span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"发生异常了.."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>常见坑点2： 在业务层捕捉异常后，发现事务不生效。 这是许多新手都会犯的一个错误，在业务层手工捕捉并处理了异常，你都把异常“吃”掉了，<code>Spring</code>自然不知道这里有错，更不会主动去回滚数据。<br>例如：下面这段代码直接导致用户新增的事务回滚没有生效。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 新增用户信息</span></span><br><span class="line">	<span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">	<span class="comment">// 新增用户岗位关联</span></span><br><span class="line">	insertUserPost(user);</span><br><span class="line">	<span class="comment">// 新增用户与角色管理</span></span><br><span class="line">	insertUserRole(user);</span><br><span class="line">	<span class="comment">// 模拟抛出SQLException异常</span></span><br><span class="line">	<span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 谨慎：尽量不要在业务层捕捉异常并处理</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> SQLException(<span class="string">"发生异常了.."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Exception e)</span><br><span class="line">		&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>推荐做法：在业务层统一抛出异常，然后在控制层统一处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 新增用户信息</span></span><br><span class="line">	<span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">	<span class="comment">// 新增用户岗位关联</span></span><br><span class="line">	insertUserPost(user);</span><br><span class="line">	<span class="comment">// 新增用户与角色管理</span></span><br><span class="line">	insertUserRole(user);</span><br><span class="line">	<span class="comment">// 模拟抛出SQLException异常</span></span><br><span class="line">	<span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"发生异常了.."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> rows;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Transactional</code>注解的常用属性表：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>propagation</td>
<td>事务的传播行为，默认值为 REQUIRED。</td>
</tr>
<tr>
<td>isolation</td>
<td>事务的隔离度，默认值采用 DEFAULT</td>
</tr>
<tr>
<td>timeout</td>
<td>事务的超时时间，默认值为-1，不超时。如果设置了超时时间(单位秒)，那么如果超过该时间限制了但事务还没有完成，则自动回滚事务。</td>
</tr>
<tr>
<td>read-only</td>
<td>指定事务是否为只读事务，默认值为 false；为了忽略那些不需要事务的方法，比如读取数据，可以设置 read-only 为 true。</td>
</tr>
<tr>
<td>rollbackFor</td>
<td>用于指定能够触发事务回滚的异常类型，如果有多个异常类型需要指定，各类型之间可以通过逗号分隔。{xxx1.class, xxx2.class,……}</td>
</tr>
<tr>
<td>noRollbackFor</td>
<td>抛出 no-rollback-for 指定的异常类型，不回滚事务。{xxx1.class, xxx2.class,……}</td>
</tr>
<tr>
<td>….</td>
</tr>
</tbody>
</table>
<p>提示</p>
<p>事务的传播机制是指如果在开始当前事务之前，一个事务上下文已经存在，此时有若干选项可以指定一个事务性方法的执行行为。 即:在执行一个@Transactinal注解标注的方法时，开启了事务；当该方法还在执行中时，另一个人也触发了该方法；那么此时怎么算事务呢，这时就可以通过事务的传播机制来指定处理方式。</p>
<p><code>TransactionDefinition</code>传播行为的常量：</p>
<table>
<thead>
<tr>
<th>常量</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>TransactionDefinition.PROPAGATION_REQUIRED</td>
<td>如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。这是默认值。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_REQUIRES_NEW</td>
<td>创建一个新的事务，如果当前存在事务，则把当前事务挂起。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_SUPPORTS</td>
<td>如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</td>
<td>以非事务方式运行，如果当前存在事务，则把当前事务挂起。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_NEVER</td>
<td>以非事务方式运行，如果当前存在事务，则抛出异常。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_MANDATORY</td>
<td>如果当前存在事务，则加入该事务；如果当前没有事务，则抛出异常。</td>
</tr>
<tr>
<td>TransactionDefinition.PROPAGATION_NESTED</td>
<td>如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行；如果当前没有事务，则该取值等价于TransactionDefinition.PROPAGATION_REQUIRED。</td>
</tr>
</tbody>
</table>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="#异常处理"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#异常处理" target="_blank" rel="noopener">#</a>异常处理</h2><p>通常一个<code>web</code>框架中，有大量需要处理的异常。比如业务异常，权限不足等等。前端通过弹出提示信息的方式告诉用户出了什么错误。 通常情况下我们用<code>try.....catch....</code>对异常进行捕捉处理，但是在实际项目中对业务模块进行异常捕捉，会造成代码重复和繁杂， 我们希望代码中只有业务相关的操作，所有的异常我们单独设立一个类来处理它。全局异常就是对框架所有异常进行统一管理。 我们在可能发生异常的方法里<code>throw</code>抛给控制器。然后由全局异常处理器对异常进行统一处理。 如此，我们的<code>Controller</code>中的方法就可以很简洁了。</p>
<p>所谓全局异常处理器就是使用<code>@ControllerAdvice</code>注解。示例如下：</p>
<p>1、统一返回实体定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.common.core.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作消息提醒</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AjaxResult</span> <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">String</span>, <span class="title">Object</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回错误消息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 错误码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 错误消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AjaxResult <span class="title">error</span><span class="params">(String msg)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        AjaxResult json = <span class="keyword">new</span> AjaxResult();</span><br><span class="line">        json.put(<span class="string">"msg"</span>, msg);</span><br><span class="line">        json.put(<span class="string">"code"</span>, <span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回成功消息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg 内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AjaxResult <span class="title">success</span><span class="params">(String msg)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        AjaxResult json = <span class="keyword">new</span> AjaxResult();</span><br><span class="line">        json.put(<span class="string">"msg"</span>, msg);</span><br><span class="line">        json.put(<span class="string">"code"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、定义登录异常定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.common.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录异常</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginException</span><span class="params">(String message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、基于<code>@ControllerAdvice</code>注解的<code>Controller</code>层的全局异常统一处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ruoyi.framework.web.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.core.domain.AjaxResult;</span><br><span class="line"><span class="keyword">import</span> com.ruoyi.common.exception.LoginException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理器</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(LoginException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AjaxResult <span class="title">loginException</span><span class="params">(LoginException e)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        log.error(e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、测试访问请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysIndexController</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/index"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(ModelMap mmap)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 模拟用户未登录，抛出业务逻辑异常</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        SysUser user = ShiroUtils.getSysUser();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNull(user))</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> LoginException(<span class="string">"用户未登录，无法访问请求。"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		mmap.put(<span class="string">"user"</span>, user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据上面代码含义，当我们未登录访问<code>/index</code>时就会发生<code>LoginException</code>业务逻辑异常，按照我们之前的全局异常配置以及统一返回实体实例化，访问后会出现<code>AjaxResult</code>格式<code>JSON</code>数据， 下面我们运行项目访问查看效果。<br>界面输出内容如下所示：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">"用户未登录，无法访问请求。"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">500</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于一些特殊情况，如接口需要返回<code>json</code>，页面请求返回<code>html</code>可以使用如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(LoginException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">loginException</span><span class="params">(HttpServletRequest request, LoginException e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	log.error(e.getMessage(), e);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ServletUtils.isAjaxRequest(request))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> AjaxResult.error(e.getMessage());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"/error/500"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若依系统的全局异常处理器<code>GlobalExceptionHandler</code><br>注意：如果全部异常处理返回<code>json</code>，那么可以使用<code>@RestControllerAdvice</code>代替<code>@ControllerAdvice</code>，这样在方法上就可以不需要添加<code>@ResponseBody</code>。</p>
<p>无法捕获异常？</p>
<p>如果您的异常无法捕获，您可以从以下几个方面着手检查</p>
<p>异常是否已被处理，即抛出异常后被catch，打印了日志或抛出了其它异常 异常是否非Controller抛出，即在拦截器或过滤器中出现的异常</p>
<h2 id="参数验证"><a href="#参数验证" class="headerlink" title="#参数验证"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#参数验证" target="_blank" rel="noopener">#</a>参数验证</h2><p><code>spring boot</code>中可以用<code>@Validated</code>来校验数据，如果数据异常则会统一抛出异常，方便异常中心统一处理。</p>
<h3 id="注解参数说明-1"><a href="#注解参数说明-1" class="headerlink" title="#注解参数说明"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#注解参数说明-2" target="_blank" rel="noopener">#</a>注解参数说明</h3><table>
<thead>
<tr>
<th>注解名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Xss</td>
<td>检查该字段是否存在跨站脚本工具</td>
</tr>
<tr>
<td>@Null</td>
<td>检查该字段为空</td>
</tr>
<tr>
<td>@NotNull</td>
<td>不能为null</td>
</tr>
<tr>
<td>@NotBlank</td>
<td>不能为空，常用于检查空字符串</td>
</tr>
<tr>
<td>@NotEmpty</td>
<td>不能为空，多用于检测list是否size是0</td>
</tr>
<tr>
<td>@Max</td>
<td>该字段的值只能小于或等于该值</td>
</tr>
<tr>
<td>@Min</td>
<td>该字段的值只能大于或等于该值</td>
</tr>
<tr>
<td>@Past</td>
<td>检查该字段的日期是在过去</td>
</tr>
<tr>
<td>@Future</td>
<td>检查该字段的日期是否是属于将来的日期</td>
</tr>
<tr>
<td>@Email</td>
<td>检查是否是一个有效的email地址</td>
</tr>
<tr>
<td>@Pattern(regex=,flag=)</td>
<td>被注释的元素必须符合指定的正则表达式</td>
</tr>
<tr>
<td>@Range(min=,max=,message=)</td>
<td>被注释的元素必须在合适的范围内</td>
</tr>
<tr>
<td>@Size(min=, max=)</td>
<td>检查该字段的size是否在min和max之间，可以是字符串、数组、集合、Map等</td>
</tr>
<tr>
<td>@Length(min=,max=)</td>
<td>检查所属的字段的长度是否在min和max之间,只能用于字符串</td>
</tr>
<tr>
<td>@AssertTrue</td>
<td>用于boolean字段，该字段只能为true</td>
</tr>
<tr>
<td>@AssertFalse</td>
<td>该字段的值只能为false</td>
</tr>
</tbody>
</table>
<h3 id="数据校验使用"><a href="#数据校验使用" class="headerlink" title="数据校验使用"></a>数据校验使用</h3><p>1、基础使用 因为<code>spring boot</code>已经引入了基础包，所以直接使用就可以了。首先在<code>controller</code>上声明<code>@Validated</code>需要对数据进行校验。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">add</span><span class="params">(@Validated @RequestBody SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、然后在对应字段<code>Get方法</code>加上参数校验注解，如果不符合验证要求，则会以<code>message</code>的信息为准，返回给前端。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">30</span>, message = <span class="string">"用户昵称长度不能超过30个字符"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"用户账号不能为空"</span>)</span><br><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">30</span>, message = <span class="string">"用户账号长度不能超过30个字符"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Email</span>(message = <span class="string">"邮箱格式不正确"</span>)</span><br><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">50</span>, message = <span class="string">"邮箱长度不能超过50个字符"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">11</span>, message = <span class="string">"手机号码长度不能超过11个字符"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPhonenumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> phonenumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以直接放在字段上面声明。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">30</span>, message = <span class="string">"用户昵称长度不能超过30个字符"</span>)</span><br><span class="line"><span class="keyword">private</span> String nickName;</span><br></pre></td></tr></table></figure>
<h3 id="自定义注解校验"><a href="#自定义注解校验" class="headerlink" title="自定义注解校验"></a>自定义注解校验</h3><p>使用原生的<code>@Validated</code>进行参数校验时，都是特定的注解去校验（例如字段长度、大小、不为空等），我们也可以用自定义的注解去进行校验，例如项目中的<code>@Xss</code>注解。</p>
<p>1、新增<code>Xss</code>注解，设置自定义校验器<code>XssValidator.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义xss校验注解</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(value = &#123; ElementType.METHOD, ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.PARAMETER &#125;)</span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = &#123; XssValidator.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Xss</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="keyword">default</span> "不允许任何脚本运行"</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、自定义<code>Xss</code>校验器，实现<code>ConstraintValidator</code>接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义xss校验注解实现</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">Xss</span>, <span class="title">String</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String HTML_PATTERN = <span class="string">"&lt;(\\S*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String value, ConstraintValidatorContext constraintValidatorContext)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !containsHtml(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsHtml</span><span class="params">(String value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Pattern pattern = Pattern.compile(HTML_PATTERN);</span><br><span class="line">        Matcher matcher = pattern.matcher(value);</span><br><span class="line">        <span class="keyword">return</span> matcher.matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、实体类使用自定义的<code>@Xss</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Xss</span>(message = <span class="string">"登录账号不能包含脚本字符"</span>)</span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"登录账号不能为空"</span>)</span><br><span class="line"><span class="meta">@Size</span>(min = <span class="number">0</span>, max = <span class="number">30</span>, message = <span class="string">"登录账号长度不能超过30个字符"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLoginName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> loginName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时在去保存会进行验证，如果不符合规则的字符（例如<code>&lt;script&gt;alert(1);&lt;/script&gt;</code>）会提示<code>登录账号不能包含脚本字符</code>，代表限制成功。</p>
<p>如果是在方法里面校验整个实体，参考示例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">protected</span> Validator validator;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importUser</span><span class="params">(SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BeanValidators.validateWithException(validator, user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义分组校验"><a href="#自定义分组校验" class="headerlink" title="#自定义分组校验"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#自定义分组校验" target="_blank" rel="noopener">#</a>自定义分组校验</h3><p>有时候我们为了在使用实体类的情况下更好的区分出新增、修改和其他操作验证的不同，可以通过<code>groups</code>属性设置。使用方式如下</p>
<p><strong>新增类接口，用于标识出不同的操作类型</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Add</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Edit</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Controller.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">addSave</span><span class="params">(@Validated(Add.class)</span> @RequestBody Xxxx xxxx)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(xxxx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">editSave</span><span class="params">(@Validated(Edit.class)</span> @RequestBody Xxxx xxxx)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(xxxx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Model.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仅在新增时验证</span></span><br><span class="line"><span class="meta">@NotNull</span>(message = <span class="string">"不能为空"</span>, groups = &#123;Add.class&#125;)</span><br><span class="line"><span class="keyword">private</span> String xxxx;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在新增和修改时验证</span></span><br><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"不能为空"</span>, groups = &#123;Add.class, Edit.class&#125;)</span><br><span class="line"><span class="keyword">private</span> String xxxx;</span><br></pre></td></tr></table></figure>
<p>提示</p>
<p>如果你有更多操作类型，也可以自定义类统一管理，使用方式就变成了<code>Type.Add</code>、<code>Type.Edit</code>、<code>Type.Xxxx</code>等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.eva.core.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Type</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Add</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Edit</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Xxxx</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="系统日志"><a href="#系统日志" class="headerlink" title="#系统日志"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#系统日志" target="_blank" rel="noopener">#</a>系统日志</h2><p>在实际开发中，对于某些关键业务，我们通常需要记录该操作的内容，一个操作调一次记录方法，每次还得去收集参数等等，会造成大量代码重复。 我们希望代码中只有业务相关的操作，在项目中使用注解来完成此项功能。</p>
<p>在需要被记录日志的<code>controller</code>方法上添加<code>@Log</code>注解，使用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log</span>(title = <span class="string">"用户管理"</span>, businessType = BusinessType.INSERT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">addSave</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注解参数说明-2"><a href="#注解参数说明-2" class="headerlink" title="#注解参数说明"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#注解参数说明-3" target="_blank" rel="noopener">#</a>注解参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>title</td>
<td>String</td>
<td>空</td>
<td>操作模块</td>
</tr>
<tr>
<td>businessType</td>
<td>BusinessType</td>
<td>OTHER</td>
<td>操作功能（<code>OTHER</code>其他、<code>INSERT</code>新增、<code>UPDATE</code>修改、<code>DELETE</code>删除、<code>GRANT</code>授权、<code>EXPORT</code>导出、<code>IMPORT</code>导入、<code>FORCE</code>强退、<code>GENCODE</code>生成代码、<code>CLEAN</code>清空数据）</td>
</tr>
<tr>
<td>operatorType</td>
<td>OperatorType</td>
<td>MANAGE</td>
<td>操作人类别（<code>OTHER</code>其他、<code>MANAGE</code>后台用户、<code>MOBILE</code>手机端用户）</td>
</tr>
<tr>
<td>isSaveRequestData</td>
<td>boolean</td>
<td>true</td>
<td>是否保存请求的参数</td>
</tr>
<tr>
<td>isSaveResponseData</td>
<td>boolean</td>
<td>true</td>
<td>是否保存响应的参数</td>
</tr>
<tr>
<td>excludeParamNames</td>
<td>String[]</td>
<td>{}</td>
<td>排除指定的请求参数</td>
</tr>
</tbody>
</table>
<h3 id="自定义操作功能"><a href="#自定义操作功能" class="headerlink" title="#自定义操作功能"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#自定义操作功能" target="_blank" rel="noopener">#</a>自定义操作功能</h3><p>1、在<code>BusinessType</code>中新增业务操作类型如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">TEST,</span><br></pre></td></tr></table></figure>
<p>2、在<code>sys_dict_data</code>字典数据表中初始化操作业务类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sys_dict_data <span class="keyword">values</span>(<span class="number">25</span>, <span class="number">10</span>, <span class="string">'测试'</span>,     <span class="string">'10'</span>, <span class="string">'sys_oper_type'</span>,       <span class="string">''</span>,   <span class="string">'primary'</span>, <span class="string">'N'</span>, <span class="string">'0'</span>, <span class="string">'admin'</span>, <span class="string">'2018-03-16 11-33-00'</span>, <span class="string">'ry'</span>, <span class="string">'2018-03-16 11-33-00'</span>, <span class="string">'测试操作'</span>);</span><br></pre></td></tr></table></figure>
<p>3、在<code>Controller</code>中使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log</span>(title = <span class="string">"测试标题"</span>, businessType = BusinessType.TEST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">test</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>操作日志记录逻辑实现代码<a href="https://gitee.com/y_project/RuoYi/blob/master/ruoyi-framework/src/main/java/com/ruoyi/framework/aspectj/LogAspect.java" target="_blank" rel="noopener">LogAspect.java(opens new window)</a><br>登录系统（系统管理-操作日志）可以查询操作日志列表和详细信息。</p>
<h2 id="数据权限"><a href="#数据权限" class="headerlink" title="#数据权限"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#数据权限" target="_blank" rel="noopener">#</a>数据权限</h2><p>在实际开发中，需要设置用户只能查看哪些部门的数据，这种情况一般称为数据权限。<br>例如对于销售，财务的数据，它们是非常敏感的，因此要求对数据权限进行控制， 对于基于集团性的应用系统而言，就更多需要控制好各自公司的数据了。如设置只能看本公司、或者本部门的数据，对于特殊的领导，可能需要跨部门的数据， 因此程序不能硬编码那个领导该访问哪些数据，需要进行后台的权限和数据权限的控制。</p>
<p>提示</p>
<p>默认系统管理员<code>admin</code>拥有所有数据权限<code>（userId=1）</code>，默认角色拥有所有数据权限（如不需要数据权限不用设置数据权限操作）</p>
<h3 id="注解参数说明-3"><a href="#注解参数说明-3" class="headerlink" title="#注解参数说明"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#注解参数说明-4" target="_blank" rel="noopener">#</a>注解参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>deptAlias</td>
<td>String</td>
<td>空</td>
<td>部门表的别名</td>
</tr>
<tr>
<td>userAlias</td>
<td>String</td>
<td>空</td>
<td>用户表的别名</td>
</tr>
</tbody>
</table>
<h3 id="数据权限使用"><a href="#数据权限使用" class="headerlink" title="#数据权限使用"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#数据权限使用" target="_blank" rel="noopener">#</a>数据权限使用</h3><p>1、在（系统管理-角色管理）设置需要数据权限的角色 目前支持以下几种权限</p>
<ul>
<li>全部数据权限</li>
<li>自定数据权限</li>
<li>部门数据权限</li>
<li>部门及以下数据权限</li>
<li>仅本人数据权限</li>
</ul>
<p>2、在需要数据权限控制方法上添加<code>@DataScope</code>注解，其中<code>d</code>和<code>u</code>用来表示表的别名</p>
<p><strong>部门数据权限注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DataScope</span>(deptAlias = <span class="string">"d"</span>)</span><br><span class="line"><span class="keyword">public</span> List&lt;...&gt; select(...)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> mapper.select(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>部门及用户权限注解</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DataScope</span>(deptAlias = <span class="string">"d"</span>, userAlias = <span class="string">"u"</span>)</span><br><span class="line"><span class="keyword">public</span> List&lt;...&gt; select(...)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> mapper.select(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、在<code>mybatis</code>查询底部标签添加数据范围过滤</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"select"</span> <span class="attr">parameterType</span>=<span class="string">"..."</span> <span class="attr">resultMap</span>=<span class="string">"...Result"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"select...Vo"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据范围过滤 --&gt;</span></span><br><span class="line">    $&#123;params.dataScope&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>例如：用户管理（未过滤数据权限的情况）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.user_id, u.dept_id, u.login_name, u.user_name, u.email</span><br><span class="line">	, u.phonenumber, u.password, u.sex, u.avatar, u.salt</span><br><span class="line">	, u.status, u.del_flag, u.login_ip, u.login_date, u.create_by</span><br><span class="line">	, u.create_time, u.remark, d.dept_name</span><br><span class="line"><span class="keyword">from</span> sys_user u</span><br><span class="line">	<span class="keyword">left</span> <span class="keyword">join</span> sys_dept d <span class="keyword">on</span> u.dept_id = d.dept_id</span><br><span class="line"><span class="keyword">where</span> u.del_flag = <span class="string">'0'</span></span><br></pre></td></tr></table></figure>
<p>例如：用户管理（已过滤数据权限的情况）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.user_id, u.dept_id, u.login_name, u.user_name, u.email</span><br><span class="line">	, u.phonenumber, u.password, u.sex, u.avatar, u.salt</span><br><span class="line">	, u.status, u.del_flag, u.login_ip, u.login_date, u.create_by</span><br><span class="line">	, u.create_time, u.remark, d.dept_name</span><br><span class="line"><span class="keyword">from</span> sys_user u</span><br><span class="line">	<span class="keyword">left</span> <span class="keyword">join</span> sys_dept d <span class="keyword">on</span> u.dept_id = d.dept_id</span><br><span class="line"><span class="keyword">where</span> u.del_flag = <span class="string">'0'</span></span><br><span class="line">	<span class="keyword">and</span> u.dept_id <span class="keyword">in</span> (</span><br><span class="line">		<span class="keyword">select</span> dept_id</span><br><span class="line">		<span class="keyword">from</span> sys_role_dept</span><br><span class="line">		<span class="keyword">where</span> role_id = <span class="number">2</span></span><br><span class="line">	)</span><br></pre></td></tr></table></figure>
<p>结果很明显，我们多了如下语句。通过角色部门表<code>（sys_role_dept）</code>完成了数据权限过滤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">and u.dept_id in (</span><br><span class="line">	<span class="keyword">select</span> dept_id</span><br><span class="line">	<span class="keyword">from</span> sys_role_dept</span><br><span class="line">	<span class="keyword">where</span> role_id = <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>逻辑实现代码 <code>com.ruoyi.framework.aspectj.DataScopeAspect</code></p>
<p>提示</p>
<p>仅实体继承<code>BaseEntity</code>才会进行处理，<code>SQL</code>语句会存放到<code>BaseEntity</code>对象中的<code>params</code>属性中，然后在<code>xml</code>中通过<code>${params.dataScope}</code>获取拼接后的语句。</p>
<h2 id="多数据源"><a href="#多数据源" class="headerlink" title="#多数据源"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#多数据源" target="_blank" rel="noopener">#</a>多数据源</h2><p>在实际开发中，经常可能遇到在一个应用中可能需要访问多个数据库的情况，在项目中使用注解来完成此项功能。</p>
<p>在需要被切换数据源的<code>Service</code>或<code>Mapper</code>方法上添加<code>@DataSource</code>注解，使用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DataSource</span>(value = DataSourceType.MASTER)</span><br><span class="line"><span class="keyword">public</span> List&lt;...&gt; select(...)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> mapper.select(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>value</code>用来表示数据源名称，除<code>MASTER</code>和<code>SLAVE</code>其他均需要进行配置。</p>
<h3 id="注解参数说明-4"><a href="#注解参数说明-4" class="headerlink" title="#注解参数说明"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#注解参数说明-5" target="_blank" rel="noopener">#</a>注解参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>DataSourceType</td>
<td>DataSourceType.MASTER</td>
<td>主库</td>
</tr>
</tbody>
</table>
<h3 id="多数据源使用"><a href="#多数据源使用" class="headerlink" title="#多数据源使用"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#多数据源使用" target="_blank" rel="noopener">#</a>多数据源使用</h3><p>1、在<code>application-druid.yml</code>配置从库数据源</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从库数据源</span></span><br><span class="line"><span class="attr">slave:</span></span><br><span class="line">	<span class="comment"># 从数据源开关/默认关闭</span></span><br><span class="line">	<span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">	<span class="attr">url:</span> <span class="attr">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">	<span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">	<span class="attr">password:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure>
<p>2、在<code>DataSourceType</code>类添加数据源枚举</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">SLAVE</span><br></pre></td></tr></table></figure>
<p>3、在<code>DruidConfig</code>配置读取数据源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"spring.datasource.druid.slave"</span>)</span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.datasource.druid.slave"</span>, name = <span class="string">"enabled"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DataSource <span class="title">slaveDataSource</span><span class="params">(DruidProperties druidProperties)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DruidDataSource dataSource = DruidDataSourceBuilder.create().build();</span><br><span class="line">	<span class="keyword">return</span> druidProperties.dataSource(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、在<code>DruidConfig</code>类<code>dataSource</code>方法添加数据源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setDataSource(targetDataSources, DataSourceType.SLAVE.name(), <span class="string">"slaveDataSource"</span>);</span><br></pre></td></tr></table></figure>
<p>5、在需要使用多数据源方法或类上添加<code>@DataSource</code>注解，其中<code>value</code>用来表示数据源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DataSource</span>(value = DataSourceType.SLAVE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysUser&gt; <span class="title">selectUserList</span><span class="params">(SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> userMapper.selectUserList(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@DataSource</span>(value = DataSourceType.SLAVE)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysUserServiceImpl</span></span></span><br></pre></td></tr></table></figure>
<h3 id="手动切换数据源"><a href="#手动切换数据源" class="headerlink" title="#手动切换数据源"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#手动切换数据源" target="_blank" rel="noopener">#</a>手动切换数据源</h3><p>在需要切换数据源的方法中使用<code>DynamicDataSourceContextHolder</code>类实现手动切换，使用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SysUser&gt; <span class="title">selectUserList</span><span class="params">(SysUser user)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DynamicDataSourceContextHolder.setDataSourceType(DataSourceType.SLAVE.name());</span><br><span class="line">	List&lt;SysUser&gt; userList = userMapper.selectUserList(user);</span><br><span class="line">	DynamicDataSourceContextHolder.clearDataSourceType();</span><br><span class="line">	<span class="keyword">return</span> userList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逻辑实现代码 <code>com.ruoyi.framework.aspectj.DataSourceAspect</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：目前配置了一个从库，默认关闭状态。如果不需要多数据源不用做任何配置。 另外可新增多个从库。支持不同数据源（Mysql、Oracle、SQLServer）</span><br></pre></td></tr></table></figure>
<p>提示</p>
<p>如果有<code>Service</code>方法内多个注解无效的情况使用内部方法调用<code>SpringUtils.getAopProxy(this).xxxxxx(xxxx)</code>;</p>
<h2 id="代码生成"><a href="#代码生成" class="headerlink" title="#代码生成"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#代码生成" target="_blank" rel="noopener">#</a>代码生成</h2><p>大部分项目里其实有很多代码都是重复的，几乎每个基础模块的代码都有增删改查的功能，而这些功能都是大同小异， 如果这些功能都要自己去写，将会大大浪费我们的精力降低效率。所以这种重复性的代码可以使用代码生成。</p>
<h3 id="默认配置"><a href="#默认配置" class="headerlink" title="#默认配置"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#默认配置" target="_blank" rel="noopener">#</a>默认配置</h3><p>单应用在<code>resources</code>目录下的<code>application.yml</code>，多模块<code>ruoyi-generator</code>中的<code>resources</code>目录下的<code>generator.yml</code>，可以自己根据实际情况调整默认配置。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代码生成</span></span><br><span class="line"><span class="attr">gen:</span> </span><br><span class="line">  <span class="comment"># 开发者姓名，生成到类注释上</span></span><br><span class="line"><span class="attr">  author:</span> <span class="string">ruoyi</span></span><br><span class="line">  <span class="comment"># 默认生成包路径 system 需改成自己的模块名称 如 system monitor tool</span></span><br><span class="line"><span class="attr">  packageName:</span> <span class="string">com.ruoyi.system</span></span><br><span class="line">  <span class="comment"># 自动去除表前缀，默认是false</span></span><br><span class="line"><span class="attr">  autoRemovePre:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 表前缀（生成类名不会包含表前缀，多个用逗号分隔）</span></span><br><span class="line"><span class="attr">  tablePrefix:</span> <span class="string">sys_</span></span><br></pre></td></tr></table></figure>
<h3 id="单表结构"><a href="#单表结构" class="headerlink" title="#单表结构"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#单表结构" target="_blank" rel="noopener">#</a>单表结构</h3><p><strong>新建数据库表结构（单表）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> sys_student;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_student (</span><br><span class="line">  student_id           <span class="built_in">int</span>(<span class="number">11</span>)         auto_increment    <span class="keyword">comment</span> <span class="string">'编号'</span>,</span><br><span class="line">  student_name         <span class="built_in">varchar</span>(<span class="number">30</span>)     <span class="keyword">default</span> <span class="string">''</span>        <span class="keyword">comment</span> <span class="string">'学生名称'</span>,</span><br><span class="line">  student_age          <span class="built_in">int</span>(<span class="number">3</span>)          <span class="keyword">default</span> <span class="literal">null</span>      <span class="keyword">comment</span> <span class="string">'年龄'</span>,</span><br><span class="line">  student_hobby        <span class="built_in">varchar</span>(<span class="number">30</span>)     <span class="keyword">default</span> <span class="string">''</span>        <span class="keyword">comment</span> <span class="string">'爱好（0代码 1音乐 2电影）'</span>,</span><br><span class="line">  student_sex          <span class="built_in">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">'0'</span>       <span class="keyword">comment</span> <span class="string">'性别（0男 1女 2未知）'</span>,</span><br><span class="line">  student_status       <span class="built_in">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">'0'</span>       <span class="keyword">comment</span> <span class="string">'状态（0正常 1停用）'</span>,</span><br><span class="line">  student_birthday     datetime                          <span class="keyword">comment</span> <span class="string">'生日'</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (student_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">comment</span> = <span class="string">'学生信息表'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="树表结构"><a href="#树表结构" class="headerlink" title="#树表结构"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#树表结构" target="_blank" rel="noopener">#</a>树表结构</h3><p><strong>新建数据库表结构（树表）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> sys_product;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_product (</span><br><span class="line">  product_id        <span class="built_in">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="literal">null</span> auto_increment    <span class="keyword">comment</span> <span class="string">'产品id'</span>,</span><br><span class="line">  parent_id         <span class="built_in">bigint</span>(<span class="number">20</span>)      <span class="keyword">default</span> <span class="number">0</span>                  <span class="keyword">comment</span> <span class="string">'父产品id'</span>,</span><br><span class="line">  product_name      <span class="built_in">varchar</span>(<span class="number">30</span>)     <span class="keyword">default</span> <span class="string">''</span>                 <span class="keyword">comment</span> <span class="string">'产品名称'</span>,</span><br><span class="line">  order_num         <span class="built_in">int</span>(<span class="number">4</span>)          <span class="keyword">default</span> <span class="number">0</span>                  <span class="keyword">comment</span> <span class="string">'显示顺序'</span>,</span><br><span class="line">  <span class="keyword">status</span>            <span class="built_in">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">'0'</span>                <span class="keyword">comment</span> <span class="string">'产品状态（0正常 1停用）'</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (product_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">comment</span> = <span class="string">'产品表'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="主子表结构"><a href="#主子表结构" class="headerlink" title="#主子表结构"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#主子表结构" target="_blank" rel="noopener">#</a>主子表结构</h3><p><strong>新建数据库表结构（主子表）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- 客户表</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> sys_customer;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_customer (</span><br><span class="line">  customer_id           <span class="built_in">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="literal">null</span> auto_increment    <span class="keyword">comment</span> <span class="string">'客户id'</span>,</span><br><span class="line">  customer_name         <span class="built_in">varchar</span>(<span class="number">30</span>)     <span class="keyword">default</span> <span class="string">''</span>                 <span class="keyword">comment</span> <span class="string">'客户姓名'</span>,</span><br><span class="line">  phonenumber           <span class="built_in">varchar</span>(<span class="number">11</span>)     <span class="keyword">default</span> <span class="string">''</span>                 <span class="keyword">comment</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  sex                   <span class="built_in">varchar</span>(<span class="number">20</span>)     <span class="keyword">default</span> <span class="literal">null</span>               <span class="keyword">comment</span> <span class="string">'客户性别'</span>,</span><br><span class="line">  birthday              datetime                                   <span class="keyword">comment</span> <span class="string">'客户生日'</span>,</span><br><span class="line">  remark                <span class="built_in">varchar</span>(<span class="number">500</span>)    <span class="keyword">default</span> <span class="literal">null</span>               <span class="keyword">comment</span> <span class="string">'客户描述'</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (customer_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">comment</span> = <span class="string">'客户表'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- 商品表</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> sys_goods;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_goods (</span><br><span class="line">  goods_id           <span class="built_in">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="literal">null</span> auto_increment    <span class="keyword">comment</span> <span class="string">'商品id'</span>,</span><br><span class="line">  customer_id        <span class="built_in">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="literal">null</span>                   <span class="keyword">comment</span> <span class="string">'客户id'</span>,</span><br><span class="line">  <span class="keyword">name</span>               <span class="built_in">varchar</span>(<span class="number">30</span>)     <span class="keyword">default</span> <span class="string">''</span>                 <span class="keyword">comment</span> <span class="string">'商品名称'</span>,</span><br><span class="line">  weight             <span class="built_in">int</span>(<span class="number">5</span>)          <span class="keyword">default</span> <span class="literal">null</span>               <span class="keyword">comment</span> <span class="string">'商品重量'</span>,</span><br><span class="line">  price              <span class="built_in">decimal</span>(<span class="number">6</span>,<span class="number">2</span>)    <span class="keyword">default</span> <span class="literal">null</span>               <span class="keyword">comment</span> <span class="string">'商品价格'</span>,</span><br><span class="line">  <span class="built_in">date</span>               datetime                                   <span class="keyword">comment</span> <span class="string">'商品时间'</span>,</span><br><span class="line">  <span class="keyword">type</span>               <span class="built_in">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="literal">null</span>               <span class="keyword">comment</span> <span class="string">'商品种类'</span>,</span><br><span class="line">  primary <span class="keyword">key</span> (goods_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">comment</span> = <span class="string">'商品表'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="代码生成使用"><a href="#代码生成使用" class="headerlink" title="#代码生成使用"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#代码生成使用" target="_blank" rel="noopener">#</a>代码生成使用</h3><p>1、登录系统（系统工具 -&gt; 代码生成 -&gt; 导入对应表）</p>
<p>2、代码生成列表中找到需要表（可预览、编辑、同步、删除生成配置）</p>
<p>3、点击生成代码会得到一个<code>ruoyi.zip</code>执行<code>sql</code>文件，按照包内目录结构复制到自己的项目中即可</p>
<p>代码生成支持编辑、预览、同步</p>
<p>预览：对生成的代码提前预览，防止出现一些不符合预期的情况。</p>
<p>同步：对原表的字段进行同步，包括新增、删除、修改的字段处理。</p>
<p>修改：对生成的代码基本信息、字段信息、生成信息做一系列的调整。</p>
<p>另外多模块所有代码生成的相关业务逻辑代码在<code>ruoyi-generator</code>模块，不需要可以自行删除模块。</p>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="#定时任务"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#定时任务" target="_blank" rel="noopener">#</a>定时任务</h2><p>在实际项目开发中Web应用有一类不可缺少的，那就是定时任务。 定时任务的场景可以说非常广泛，比如某些视频网站，购买会员后，每天会给会员送成长值，每月会给会员送一些电影券； 比如在保证最终一致性的场景中，往往利用定时任务调度进行一些比对工作；比如一些定时需要生成的报表、邮件；比如一些需要定时清理数据的任务等。 所以我们提供方便友好的web界面，实现动态管理任务，可以达到动态控制定时任务启动、暂停、重启、删除、添加、修改等操作，极大地方便了开发过程。</p>
<p>提示</p>
<p>关于定时任务使用流程</p>
<p>1、后台添加定时任务处理类（支持<code>Bean</code>调用、<code>Class</code>类调用）<br><code>Bean</code>调用示例：需要添加对应<code>Bean</code>注解<code>@Component</code>或<code>@Service</code>。调用目标字符串：<code>ryTask.ryParams(&#39;ry&#39;)</code><br><code>Class</code>类调用示例：添加类和方法指定包即可。调用目标字符串：<code>com.ruoyi.quartz.task.RyTask.ryParams(&#39;ry&#39;)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定时任务调度测试</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ruoyi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"ryTask"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RyTask</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ryMultipleParams</span><span class="params">(String s, Boolean b, Long l, Double d, Integer i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(StringUtils.format(<span class="string">"执行多参方法： 字符串类型&#123;&#125;，布尔类型&#123;&#125;，长整型&#123;&#125;，浮点型&#123;&#125;，整形&#123;&#125;"</span>, s, b, l, d, i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ryParams</span><span class="params">(String params)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行有参方法："</span> + params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ryNoParams</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"执行无参方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、前端新建定时任务信息（系统监控 -&gt; 定时任务）<br>任务名称：自定义，如：定时查询任务状态<br>任务分组：根据字典<code>sys_job_group</code>配置<br>调用目标字符串：设置后台任务方法名称参数<br>执行表达式：可查询官方<code>cron</code>表达式介绍<br>执行策略：定时任务自定义执行策略<br>并发执行：是否需要多个任务间同时执行<br>状态：是否启动定时任务<br>备注：定时任务描述信息</p>
<p>3、点击执行一次，测试定时任务是否正常及调度日志是否正确记录，如正常执行表示任务配置成功。</p>
<p>执行策略详解：<br><code>立即执行</code>（所有<code>misfire</code>的任务会马上执行）打个比方，如果9点<code>misfire</code>了，在10：15系统恢复之后，9点，10点的<code>misfire</code>会马上执行<br><code>执行一次</code>（会合并部分的<code>misfire</code>，正常执行下一个周期的任务）假设9，10的任务都<code>misfire</code>了，系统在10：15分起来了。只会执行一次<code>misfire</code>，下次正点执行。<br><code>放弃执行</code>(所有的<code>misfire</code>不管，执行下一个周期的任务)</p>
<p>方法参数详解：<br><code>字符串</code>（需要单引号’’标识 如：<code>ryTask.ryParams(’ry’)</code>）<br><code>布尔类型</code>（需要true false标识 如：<code>ryTask.ryParams(true)</code>）<br><code>长整型</code>（需要L标识 如：<code>ryTask.ryParams(2000L)</code>）<br><code>浮点型</code>（需要D标识 如：<code>ryTask.ryParams(316.50D)</code>）<br><code>整型</code>（纯数字即可）</p>
<p>cron表达式语法:<br>[秒] [分] [小时] [日] [月] [周] [年]</p>
<table>
<thead>
<tr>
<th>说明</th>
<th>必填</th>
<th>允许填写的值</th>
<th>允许的通配符</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>分</td>
<td>是</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>时</td>
<td>是</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>日</td>
<td>是</td>
<td>1-31</td>
<td>, - * /</td>
</tr>
<tr>
<td>月</td>
<td>是</td>
<td>1-12 / JAN-DEC</td>
<td>, - * ? / L W</td>
</tr>
<tr>
<td>周</td>
<td>是</td>
<td>1-7 or SUN-SAT</td>
<td>, - * ? / L #</td>
</tr>
<tr>
<td>年</td>
<td>是</td>
<td>1970-2099</td>
<td>, - * /</td>
</tr>
</tbody>
</table>
<p>通配符说明:<br><code>*</code> 表示所有值。 例如:在分的字段上设置 <em>,表示每一分钟都会触发<br><code>?</code> 表示不指定值。使用的场景为不需要关心当前设置这个字段的值。例如:要在每月的10号触发一个操作，但不关心是周几，所以需要周位置的那个字段设置为”?” 具体设置为 0 0 0 10 </em> ?<br><code>-</code> 表示区间。例如 在小时上设置 “10-12”,表示 10,11,12点都会触发<br><code>,</code> 表示指定多个值，例如在周字段上设置 “MON,WED,FRI” 表示周一，周三和周五触发<br><code>/</code> 用于递增触发。如在秒上面设置”5/15” 表示从5秒开始，每增15秒触发(5,20,35,50)。 在月字段上设置’1/3’所示每月1号开始，每隔三天触发一次<br><code>L</code> 表示最后的意思。在日字段设置上，表示当月的最后一天(依据当前月份，如果是二月还会依据是否是润年[leap]), 在周字段上表示星期六，相当于”7”或”SAT”。如果在”L”前加上数字，则表示该数据的最后一个。例如在周字段上设置”6L”这样的格式,则表示“本月最后一个星期五”<br><code>W</code> 表示离指定日期的最近那个工作日(周一至周五). 例如在日字段上置”15W”，表示离每月15号最近的那个工作日触发。如果15号正好是周六，则找最近的周五(14号)触发, 如果15号是周未，则找最近的下周一(16号)触发.如果15号正好在工作日(周一至周五)，则就在该天触发。如果指定格式为 “1W”,它则表示每月1号往后最近的工作日触发。如果1号正是周六，则将在3号下周一触发。(注，”W”前只能设置具体的数字,不允许区间”-“)<br><code>#</code> 序号(表示每月的第几个周几)，例如在周字段上设置”6#3”表示在每月的第三个周六.注意如果指定”#5”,正好第五周没有周六，则不会触发该配置(用在母亲节和父亲节再合适不过了) ；小提示：’L’和 ‘W’可以一组合使用。如果在日字段上设置”LW”,则表示在本月的最后一个工作日触发；周字段的设置，若使用英文字母是不区分大小写的，即MON与mon相同</p>
<p>常用表达式例子:</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 0 2 1 <em> ? </em></td>
<td>表示在每月的1日的凌晨2点调整任务</td>
</tr>
<tr>
<td>0 15 10 ? * MON-FRI</td>
<td>表示周一到周五每天上午10:15执行作业</td>
</tr>
<tr>
<td>0 15 10 ? 6L 2002-2006</td>
<td>表示2002-2006年的每个月的最后一个星期五上午10:15执行作</td>
</tr>
<tr>
<td>0 0 10,14,16 <em> </em> ?</td>
<td>每天上午10点，下午2点，4点</td>
</tr>
<tr>
<td>0 0/30 9-17 <em> </em> ?</td>
<td>朝九晚五工作时间内每半小时</td>
</tr>
<tr>
<td>0 0 12 ? * WED</td>
<td>表示每个星期三中午12点</td>
</tr>
<tr>
<td>0 0 12 <em> </em> ?</td>
<td>每天中午12点触发</td>
</tr>
<tr>
<td>0 15 10 ? <em> </em></td>
<td>每天上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 <em> </em> ?</td>
<td>每天上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 <em> </em> ? *</td>
<td>每天上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 <em> </em> ? 2005</td>
<td>2005年的每天上午10:15触发</td>
</tr>
<tr>
<td>0 <em> 14 </em> * ?</td>
<td>在每天下午2点到下午2:59期间的每1分钟触发</td>
</tr>
<tr>
<td>0 0/5 14 <em> </em> ?</td>
<td>在每天下午2点到下午2:55期间的每5分钟触发</td>
</tr>
<tr>
<td>0 0/5 14,18 <em> </em> ?</td>
<td>在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</td>
</tr>
<tr>
<td>0 0-5 14 <em> </em> ?</td>
<td>在每天下午2点到下午2:05期间的每1分钟触发</td>
</tr>
<tr>
<td>0 10,44 14 ? 3 WED</td>
<td>每年三月的星期三的下午2:10和2:44触发</td>
</tr>
<tr>
<td>0 15 10 ? * MON-FRI</td>
<td>周一至周五的上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 15 * ?</td>
<td>每月15日上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 L * ?</td>
<td>每月最后一日的上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6L</td>
<td>每月的最后一个星期五上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6L 2002-2005</td>
<td>2002年至2005年的每月的最后一个星期五上午10:15触发</td>
</tr>
<tr>
<td>0 15 10 ? * 6#3</td>
<td>每月的第三个星期五上午10:15触发</td>
</tr>
</tbody>
</table>
<p>多模块所有定时任务的相关业务逻辑代码在<code>ruoyi-quartz</code>模块，可以自行调整或剔除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：不同数据源定时任务都有对应脚本，Oracle、Mysql已经有了，其他的可自行下载执行</span><br></pre></td></tr></table></figure>
<h2 id="系统接口"><a href="#系统接口" class="headerlink" title="#系统接口"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#系统接口" target="_blank" rel="noopener">#</a>系统接口</h2><p>在现在的开发过程中还有很大一部分公司都是以口口相传的方式来进行前后端的联调，而接口文档很大一部分都只停留在了说说而已的地步，或者写了代码再写文档。 还有一点就是文档的修改，定义好的接口并不是一成不变的，可能在开发过程中文档修改不止一次的变化，这个时候就会很难受了。 只要不是强制性要求，没人会愿意写这东西，而且在写的过程中，一个字母的错误就会导致联调时候的很大麻烦，但是通过<code>Swagger</code>，我们可以省略了这一步，而且文档出错率近乎于零， 只要你在写代码的时候，稍加几个注解，文档自动生成。</p>
<p>1、在控制层<code>Controller</code>中添加注解来描述接口信息如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api</span>(<span class="string">"参数配置"</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/system/config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigController</span></span></span><br></pre></td></tr></table></figure>
<p>2、在方法中配置接口的标题信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@ApiOperation("查询参数列表")</span><br><span class="line">@ResponseBody</span><br><span class="line">public TableDataInfo list(Config config)</span><br><span class="line">&#123;</span><br><span class="line">	startPage();</span><br><span class="line">	List&lt;Config&gt; list = configService.selectConfigList(config);</span><br><span class="line">	return getDataTable(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、在<code>系统工具-系统接口</code>测试相关接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：SwaggerConfig可以指定根据注解或者包名扫描具体的API</span><br></pre></td></tr></table></figure>
<p>API详细说明</p>
<table>
<thead>
<tr>
<th>作用范围</th>
<th>API</th>
<th>使用位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>协议集描述</td>
<td>@Api</td>
<td>用于controller类上</td>
</tr>
<tr>
<td>对象属性</td>
<td>@ApiModelProperty</td>
<td>用在出入参数对象的字段上</td>
</tr>
<tr>
<td>协议描述</td>
<td>@ApiOperation</td>
<td>用在controller的方法上</td>
</tr>
<tr>
<td>Response集</td>
<td>@ApiResponses</td>
<td>用在controller的方法上</td>
</tr>
<tr>
<td>Response</td>
<td>@ApiResponse</td>
<td>用在 @ApiResponses里边</td>
</tr>
<tr>
<td>非对象参数集</td>
<td>@ApiImplicitParams</td>
<td>用在controller的方法上</td>
</tr>
<tr>
<td>非对象参数描述</td>
<td>@ApiImplicitParam</td>
<td>用在@ApiImplicitParams的方法里边</td>
</tr>
<tr>
<td>描述返回对象的意义</td>
<td>@ApiModel</td>
<td>用在返回对象类上</td>
</tr>
</tbody>
</table>
<p><code>api</code>标记，用在类上，说明该类的作用。可以标记一个<code>Controller</code>类做为<code>Swagger</code>文档资源，使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api</span>(value = <span class="string">"/user"</span>, description = <span class="string">"用户管理"</span>)</span><br></pre></td></tr></table></figure>
<p>与<code>Controller</code>注解并列使用。 属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>url的路径值</td>
</tr>
<tr>
<td>tags</td>
<td>如果设置这个值、value的值会被覆盖</td>
</tr>
<tr>
<td>description</td>
<td>对api资源的描述</td>
</tr>
<tr>
<td>basePath</td>
<td>基本路径可以不配置</td>
</tr>
<tr>
<td>position</td>
<td>如果配置多个Api 想改变显示的顺序位置</td>
</tr>
<tr>
<td>produces</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>consumes</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>protocols</td>
<td>Possible values: http, https, ws, wss.</td>
</tr>
<tr>
<td>authorizations</td>
<td>高级特性认证时配置</td>
</tr>
<tr>
<td>hidden</td>
<td>配置为true 将在文档中隐藏</td>
</tr>
</tbody>
</table>
<p><code>ApiOperation</code>标记，用在方法上，说明方法的作用，每一个<code>url</code>资源的定义,使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"获取用户信息"</span>)</span><br></pre></td></tr></table></figure>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>url的路径值</td>
</tr>
<tr>
<td>tags</td>
<td>如果设置这个值、value的值会被覆盖</td>
</tr>
<tr>
<td>description</td>
<td>对api资源的描述</td>
</tr>
<tr>
<td>basePath</td>
<td>基本路径可以不配置</td>
</tr>
<tr>
<td>position</td>
<td>如果配置多个Api 想改变显示的顺序位置</td>
</tr>
<tr>
<td>produces</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>consumes</td>
<td>For example, “application/json, application/xml”</td>
</tr>
<tr>
<td>protocols</td>
<td>Possible values: http, https, ws, wss.</td>
</tr>
<tr>
<td>authorizations</td>
<td>高级特性认证时配置</td>
</tr>
<tr>
<td>hidden</td>
<td>配置为true将在文档中隐藏</td>
</tr>
<tr>
<td>response</td>
<td>返回的对象</td>
</tr>
<tr>
<td>responseContainer</td>
<td>这些对象是有效的 “List”, “Set” or “Map”.，其他无效</td>
</tr>
<tr>
<td>httpMethod</td>
<td>“GET”, “HEAD”, “POST”, “PUT”, “DELETE”, “OPTIONS” and “PATCH”</td>
</tr>
<tr>
<td>code</td>
<td>http的状态码 默认 200</td>
</tr>
<tr>
<td>extensions</td>
<td>扩展属性</td>
</tr>
</tbody>
</table>
<p><code>ApiParam</code>标记，请求属性，使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TableDataInfo <span class="title">list</span><span class="params">(@ApiParam(value = <span class="string">"查询用户列表"</span>, required = <span class="keyword">true</span>)</span>User user)</span></span><br></pre></td></tr></table></figure>
<p>与Controller中的方法并列使用，属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>属性名称</td>
</tr>
<tr>
<td>value</td>
<td>属性值</td>
</tr>
<tr>
<td>defaultValue</td>
<td>默认属性值</td>
</tr>
<tr>
<td>allowableValues</td>
<td>可以不配置</td>
</tr>
<tr>
<td>required</td>
<td>是否属性必填</td>
</tr>
<tr>
<td>access</td>
<td>不过多描述</td>
</tr>
<tr>
<td>allowMultiple</td>
<td>默认为false</td>
</tr>
<tr>
<td>hidden</td>
<td>隐藏该属性</td>
</tr>
<tr>
<td>example</td>
<td>举例子</td>
</tr>
</tbody>
</table>
<p><code>ApiResponse</code>标记，响应配置，使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiResponse</span>(code = <span class="number">400</span>, message = <span class="string">"查询用户失败"</span>)</span><br></pre></td></tr></table></figure>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>http的状态码</td>
</tr>
<tr>
<td>message</td>
<td>描述</td>
</tr>
<tr>
<td>response</td>
<td>默认响应类 Void</td>
</tr>
<tr>
<td>reference</td>
<td>参考ApiOperation中配置</td>
</tr>
<tr>
<td>responseHeaders</td>
<td>参考 ResponseHeader 属性配置说明</td>
</tr>
<tr>
<td>responseContainer</td>
<td>参考ApiOperation中配置</td>
</tr>
</tbody>
</table>
<p><code>ApiResponses</code>标记，响应集配置，使用方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiResponses</span>(&#123; <span class="meta">@ApiResponse</span>(code = <span class="number">400</span>, message = <span class="string">"无效的用户"</span>) &#125;)</span><br></pre></td></tr></table></figure>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>多个ApiResponse配置</td>
</tr>
</tbody>
</table>
<p><code>ResponseHeader</code>标记，响应头设置，使用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseHeader</span>(name=<span class="string">"head"</span>,description=<span class="string">"响应头设计"</span>)</span><br></pre></td></tr></table></figure>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table>
<thead>
<tr>
<th>属性名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>响应头名称</td>
</tr>
<tr>
<td>description</td>
<td>描述</td>
</tr>
<tr>
<td>response</td>
<td>默认响应类 void</td>
</tr>
<tr>
<td>responseContainer</td>
<td>参考ApiOperation中配置</td>
</tr>
</tbody>
</table>
<h2 id="防重复提交"><a href="#防重复提交" class="headerlink" title="#防重复提交"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#防重复提交" target="_blank" rel="noopener">#</a>防重复提交</h2><p>在接口方法上添加<code>@RepeatSubmit</code>注解即可，注解参数说明：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>interval</td>
<td>int</td>
<td>5000</td>
<td>间隔时间(ms)，小于此时间视为重复提交</td>
</tr>
<tr>
<td>message</td>
<td>String</td>
<td>不允许重复提交，请稍后再试</td>
<td>提示消息</td>
</tr>
</tbody>
</table>
<p><strong>示例1：采用默认参数</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepeatSubmit</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">addSave</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>示例2：指定防重复时间和错误消息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepeatSubmit</span>(interval = <span class="number">1000</span>, message = <span class="string">"请求过于频繁"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> AjaxResult <span class="title">addSave</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> success(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="国际化支持"><a href="#国际化支持" class="headerlink" title="#国际化支持"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#国际化支持" target="_blank" rel="noopener">#</a>国际化支持</h2><p>在我们开发WEB项目的时候，项目可能涉及到在国外部署或者应用，也有可能会有国外的用户对项目进行访问，那么在这种项目中， 为客户展现的页面或者操作的信息就需要使用不同的语言，这就是我们所说的项目国际化。 目前项目已经支持多语言国际化，接下来我们介绍如何使用。</p>
<h3 id="后台国际化流程"><a href="#后台国际化流程" class="headerlink" title="#后台国际化流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#后台国际化流程" target="_blank" rel="noopener">#</a>后台国际化流程</h3><p>1、修改<code>I18nConfig</code>设置默认语言，如默认<code>中文</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认语言，英文可以设置Locale.US</span></span><br><span class="line">slr.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);</span><br></pre></td></tr></table></figure>
<p>2、修改配置<code>application.yml</code>中的<code>basename</code>国际化文件，默认是<code>i18n</code>路径下<code>messages</code>文件<br>（比如现在国际化文件是<code>xx_zh_CN.properties</code>、<code>xx_en_US.properties</code>，那么<code>basename</code>配置应为是<code>i18n/xx</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 资源信息</span></span><br><span class="line"><span class="attr">  messages:</span></span><br><span class="line">    <span class="comment"># 国际化资源文件路径</span></span><br><span class="line"><span class="attr">    basename:</span> <span class="string">static/i18n/messages</span></span><br></pre></td></tr></table></figure>
<p>3、<code>i18n</code>目录文件下定义资源文件<br>美式英语 <code>messages_en_US.properties</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user.login.username=User name</span><br><span class="line">user.login.password=Password</span><br><span class="line">user.login.code=Security code</span><br><span class="line">user.login.remember=Remember me</span><br><span class="line">user.login.submit=Sign In</span><br></pre></td></tr></table></figure>
<p>中文简体 <code>messages_zh_CN.properties</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user.login.username=用户名</span><br><span class="line">user.login.password=密码</span><br><span class="line">user.login.code=验证码</span><br><span class="line">user.login.remember=记住我</span><br><span class="line">user.login.submit=登录</span><br></pre></td></tr></table></figure>
<p>4、java代码使用<code>MessageUtils</code>获取国际化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MessageUtils.message(<span class="string">"user.login.username"</span>)</span><br><span class="line">MessageUtils.message(<span class="string">"user.login.password"</span>)</span><br><span class="line">MessageUtils.message(<span class="string">"user.login.code"</span>)</span><br><span class="line">MessageUtils.message(<span class="string">"user.login.remember"</span>)</span><br><span class="line">MessageUtils.message(<span class="string">"user.login.submit"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="前端国际化流程"><a href="#前端国际化流程" class="headerlink" title="#前端国际化流程"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#前端国际化流程" target="_blank" rel="noopener">#</a>前端国际化流程</h3><p>1、html使用国际化#{资源文件key}</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"signupForm"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"no-margins"</span>&gt;</span>登录：<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"m-t-md"</span>&gt;</span>你若不离不弃，我必生死相依<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>     <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control uname"</span>  <span class="attr">th:placeholder</span>=<span class="string">"#&#123;user.login.username&#125;"</span>   /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control pword"</span>  <span class="attr">th:placeholder</span>=<span class="string">"#&#123;user.login.password&#125;"</span>   /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row m-t"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;captchaEnabled==true&#125;"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-6"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"validateCode"</span> <span class="attr">class</span>=<span class="string">"form-control code"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;user.login.code&#125;"</span> <span class="attr">maxlength</span>=<span class="string">"5"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-6"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:void(0);"</span> <span class="attr">title</span>=<span class="string">"点击更换验证码"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">"@&#123;captcha/captchaImage(type=$&#123;captchaType&#125;)&#125;"</span> <span class="attr">class</span>=<span class="string">"imgcode"</span> <span class="attr">width</span>=<span class="string">"85%"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox-custom"</span> <span class="attr">th:classappend</span>=<span class="string">"$&#123;captchaEnabled==false&#125; ? 'm-t'"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"rememberme"</span> <span class="attr">name</span>=<span class="string">"rememberme"</span>&gt;</span> <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"rememberme"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;user.login.remember&#125;"</span>&gt;</span>记住我<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-success btn-block"</span> <span class="attr">id</span>=<span class="string">"btnSubmit"</span> <span class="attr">data-loading</span>=<span class="string">"正在验证登录，请稍后..."</span> <span class="attr">th:text</span>=<span class="string">"#&#123;user.login.submit&#125;"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、js使用国际化 首先在文件引入<code>jquery-i18n-properties</code>依赖，然后在初始化后即可通过JS函数获取对应国际化文件的内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--jQuery国际化插件--&gt;</span><br><span class="line">&lt;script src=<span class="string">"../static/js/jquery.i18n.properties.min.js"</span> th:src=<span class="string">"@&#123;/js/jquery.i18n.properties.min.js&#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;script th:inline=<span class="string">"javascript"</span>&gt;</span><br><span class="line">	<span class="comment">//获取应用路径</span></span><br><span class="line">	var ROOT = [[$&#123;#servletContext.contextPath&#125;]];</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取默认语言</span></span><br><span class="line">	var LANG_COUNTRY = [[$&#123;#locale.language+'_'+#locale.country&#125;]];</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化i18n插件</span></span><br><span class="line">	$.i18n.properties(&#123;</span><br><span class="line">		path: ROOT + <span class="string">'/i18n/'</span>,<span class="comment">//这里表示访问路径</span></span><br><span class="line">		name: <span class="string">'messages'</span>,<span class="comment">//文件名开头</span></span><br><span class="line">		language: LANG_COUNTRY,<span class="comment">//文件名语言 例如en_US</span></span><br><span class="line">		mode: <span class="string">'map'</span><span class="comment">//默认值</span></span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化i18n函数</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">i18n</span>(<span class="params">msgKey</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> $.i18n.prop(msgKey);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">			<span class="keyword">return</span> msgKey;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取国际化翻译值</span></span><br><span class="line">	<span class="built_in">console</span>.log(i18n(<span class="string">'user.login.username'</span>));</span><br><span class="line">	<span class="built_in">console</span>.log(i18n(<span class="string">'user.login.password'</span>));</span><br><span class="line">	<span class="built_in">console</span>.log(i18n(<span class="string">'user.login.code'</span>));</span><br><span class="line">	<span class="built_in">console</span>.log(i18n(<span class="string">'user.login.remember'</span>));</span><br><span class="line">	<span class="built_in">console</span>.log(i18n(<span class="string">'user.login.submit'</span>));</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、界面定义切换语言</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?lang=en_US"</span>&gt;</span> 英语 <span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?lang=zh_CN"</span>&gt;</span> 中文 <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="新建子模块"><a href="#新建子模块" class="headerlink" title="#新建子模块"></a><a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#新建子模块" target="_blank" rel="noopener">#</a>新建子模块</h2><p><code>Maven</code>多模块下新建子模块流程案例。</p>
<p>1、新建业务模块目录，例如：<code>ruoyi-test</code>。</p>
<p>2、在<code>ruoyi-test</code>业务模块下新建<code>pom.xml</code>文件以及<code>src\main\java</code>，<code>src\main\resources</code>目录。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">        test系统模块</span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 通用工具--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、根目录<code>pom.xml</code>依赖声明节点<code>dependencies</code>中添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试模块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ruoyi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、根目录<code>pom.xml</code>模块节点<code>modules</code>添加业务模块</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>ruoyi-test<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>5、<code>ruoyi-admin</code>目录<code>pom.xml</code>添加模块依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试模块--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ruoyi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ruoyi-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>6、测试模块</p>
<p>在<code>ruoyi-test</code>业务模块添加<code>com.ruoyi.test</code>包，新建<code>TestService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">helloTest</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>ruoyi-admin</code>新建测试类，调用<code>helloTest</code>成功返回<code>hello</code>代表成功。</p>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div>Boss 扫一下呗</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.png" alt="两角纸 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.png" alt="两角纸 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ruoyi/" rel="tag"><i class="fa fa-tag"></i> ruoyi</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/28/Springboot经典学习笔记/" rel="next" title="Springboot经典学习笔记">
                <i class="fa fa-chevron-left"></i> Springboot经典学习笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="两角纸">
            
              <p class="site-author-name" itemprop="name">两角纸</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/jian887" title="GitHub &rarr; https://github.com/jian887" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://weibo.com/u/5231379004?is_hot=1" title="Weibo &rarr; https://weibo.com/u/5231379004?is_hot=1" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#分页实现"><span class="nav-number">1.</span> <span class="nav-text">分页实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前端调用实现"><span class="nav-number">1.1.</span> <span class="nav-text">#前端调用实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#后台逻辑实现"><span class="nav-number">1.2.</span> <span class="nav-text">#后台逻辑实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导入导出"><span class="nav-number">2.</span> <span class="nav-text">#导入导出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解参数说明"><span class="nav-number">2.1.</span> <span class="nav-text">#注解参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导出实现流程"><span class="nav-number">2.2.</span> <span class="nav-text">#导出实现流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入实现流程"><span class="nav-number">2.3.</span> <span class="nav-text">#导入实现流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义标题信息"><span class="nav-number">2.4.</span> <span class="nav-text">#自定义标题信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义数据处理器"><span class="nav-number">2.5.</span> <span class="nav-text">#自定义数据处理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义隐藏属性列"><span class="nav-number">2.6.</span> <span class="nav-text">#自定义隐藏属性列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导出对象的子列表"><span class="nav-number">2.7.</span> <span class="nav-text">#导出对象的子列表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上传下载"><span class="nav-number">3.</span> <span class="nav-text">#上传下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#上传实现流程"><span class="nav-number">3.1.</span> <span class="nav-text">#上传实现流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载实现流程"><span class="nav-number">3.2.</span> <span class="nav-text">#下载实现流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#权限注解"><span class="nav-number">4.</span> <span class="nav-text">权限注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RequiresRoles"><span class="nav-number">4.1.</span> <span class="nav-text">@RequiresRoles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequiresPermissions"><span class="nav-number">4.2.</span> <span class="nav-text">#@RequiresPermissions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编程式判断资源访问权限"><span class="nav-number">4.3.</span> <span class="nav-text">#编程式判断资源访问权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于URI判断用户访问权限"><span class="nav-number">4.4.</span> <span class="nav-text">#基于URI判断用户访问权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务管理"><span class="nav-number">5.</span> <span class="nav-text">事务管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#异常处理"><span class="nav-number">6.</span> <span class="nav-text">#异常处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数验证"><span class="nav-number">7.</span> <span class="nav-text">#参数验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解参数说明-1"><span class="nav-number">7.1.</span> <span class="nav-text">#注解参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据校验使用"><span class="nav-number">7.2.</span> <span class="nav-text">数据校验使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义注解校验"><span class="nav-number">7.3.</span> <span class="nav-text">自定义注解校验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义分组校验"><span class="nav-number">7.4.</span> <span class="nav-text">#自定义分组校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统日志"><span class="nav-number">8.</span> <span class="nav-text">#系统日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解参数说明-2"><span class="nav-number">8.1.</span> <span class="nav-text">#注解参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义操作功能"><span class="nav-number">8.2.</span> <span class="nav-text">#自定义操作功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据权限"><span class="nav-number">9.</span> <span class="nav-text">#数据权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解参数说明-3"><span class="nav-number">9.1.</span> <span class="nav-text">#注解参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据权限使用"><span class="nav-number">9.2.</span> <span class="nav-text">#数据权限使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多数据源"><span class="nav-number">10.</span> <span class="nav-text">#多数据源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解参数说明-4"><span class="nav-number">10.1.</span> <span class="nav-text">#注解参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多数据源使用"><span class="nav-number">10.2.</span> <span class="nav-text">#多数据源使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动切换数据源"><span class="nav-number">10.3.</span> <span class="nav-text">#手动切换数据源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码生成"><span class="nav-number">11.</span> <span class="nav-text">#代码生成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#默认配置"><span class="nav-number">11.1.</span> <span class="nav-text">#默认配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单表结构"><span class="nav-number">11.2.</span> <span class="nav-text">#单表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#树表结构"><span class="nav-number">11.3.</span> <span class="nav-text">#树表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主子表结构"><span class="nav-number">11.4.</span> <span class="nav-text">#主子表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码生成使用"><span class="nav-number">11.5.</span> <span class="nav-text">#代码生成使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定时任务"><span class="nav-number">12.</span> <span class="nav-text">#定时任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统接口"><span class="nav-number">13.</span> <span class="nav-text">#系统接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#防重复提交"><span class="nav-number">14.</span> <span class="nav-text">#防重复提交</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#国际化支持"><span class="nav-number">15.</span> <span class="nav-text">#国际化支持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#后台国际化流程"><span class="nav-number">15.1.</span> <span class="nav-text">#后台国际化流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前端国际化流程"><span class="nav-number">15.2.</span> <span class="nav-text">#前端国际化流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#新建子模块"><span class="nav-number">16.</span> <span class="nav-text">#新建子模块</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
	  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8511538239750965",
    enable_page_level_ads: true
  });
</script>

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">©2019 by 两角纸</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>








        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: true,
    appId: 'WbVpdETG9NrafyGbIe8DQy6t-gzGzoHsz',
    appKey: 'fTLtfXeEprCNM3Jud6v9ph32',
    placeholder: '快来评论吧',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn'
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
